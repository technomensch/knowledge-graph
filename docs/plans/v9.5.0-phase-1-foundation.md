# v9.5.0 Phase 1: Foundation

**Session:** 1 — Claude Code
**Goal:** Plugin scaffold + 8 ported skills + Python scripts + templates + hooks/subagent
**Deliverable:** A locally testable plugin with all core knowledge capture skills working.
**Depends on:** Nothing (first phase)
**Reference:** See `v9.5.0-master-plan.md` for architecture, skill specs, config schemas, and design principles.

---

## Pre-flight

- [ ] Add `knowledge-graph-plugin/` to project `.gitignore`
- [ ] Verify current branch status: `git status`

---

## 1.1: Create plugin directory structure

```bash
cd /Users/mkaplan/Documents/GitHub/optimize-my-resume
mkdir -p knowledge-graph-plugin/{.claude-plugin,skills,agents,hooks,scripts,config,core/{templates,examples,scripts,docs,examples-hooks},docs,mcp-server}
```

Also create skill subdirectories for all 15 skills (8 ported now, 7 created in Phase 2):
```bash
cd knowledge-graph-plugin
mkdir -p skills/{capture-lesson,recall,update-graph,sync-all,update-issue-plan,session-summary,extract-chat,meta-issue,init,list,switch,add-category,configure-sanitization,check-sensitive,link-issue}
```

---

## 1.2: Create plugin scaffold

**Create new files:**

| File | Content |
|------|---------|
| `.claude-plugin/plugin.json` | Plugin manifest (see master plan for full JSON) |
| `config/kg-config-template.json` | Multi-KG configuration schema (see master plan) |
| `LICENSE` | MIT license |
| `CHANGELOG.md` | Start at v1.0.0 |

---

## 1.3: Copy existing skills → Convert to SKILL.md format (8 skills)

**Source:** `.agent/workflows/`

| Source File | Target | Action |
|-------------|--------|--------|
| `know-capture-lesson.md` | `skills/capture-lesson/SKILL.md` | Copy + add YAML frontmatter + add git metadata capture |
| `know-recall.md` | `skills/recall/SKILL.md` | Copy + add YAML frontmatter + update paths to use config |
| `know-update-graph.md` | `skills/update-graph/SKILL.md` | Copy + add YAML frontmatter + preserve git metadata |
| `know-sync-all.md` | `skills/sync-all/SKILL.md` | Copy + add YAML frontmatter |
| `know-update-issue-plan.md` | `skills/update-issue-plan/SKILL.md` | Copy + add YAML frontmatter + add PR integration |
| `doc-session-summary.md` | `skills/session-summary/SKILL.md` | Copy + add YAML frontmatter |
| `proj-extract-chat.md` | `skills/extract-chat/SKILL.md` | Copy + add YAML frontmatter |
| NEW | `skills/meta-issue/SKILL.md` | Create based on ADR-008 pattern |

**For each copy:**
1. Add YAML frontmatter (name, description, syntax)
2. Change skill invocation from `/know-*` to `/knowledge:*`
3. Update paths to read from `~/.claude/kg-config.json` (active KG)
4. Remove project-specific examples (resume, enforcement, v9.3.x)

---

## 1.4: Copy Python scripts (5 files + 1 new)

**Source:** `chat-history/scripts/`

| Source | Target | Changes |
|--------|--------|---------|
| `extract_claude.py` | `core/scripts/extract_claude.py` | Copy as-is (includes backup fix) |
| `extract_gemini.py` | `core/scripts/extract_gemini.py` | Copy as-is |
| `chat_extractor_base.py` | `core/scripts/chat_extractor_base.py` | **Fix:** Add `--output-dir` CLI arg to override `OUTPUT_DIR` |
| `run_extraction.py` | `core/scripts/run_extraction.py` | **Fix:** Add `--output-dir` passthrough arg |
| NEW | `core/scripts/requirements.txt` | `# stdlib only (blackboxprotobuf optional for Gemini protobuf)` |

**Critical fix (Opus #4):** `chat_extractor_base.py` currently derives `OUTPUT_DIR` from `os.path.dirname(__file__)`. When installed as a plugin, `__file__` resolves to the plugin cache, not the user's project. Add:
```python
# Allow override via CLI or environment
OUTPUT_DIR = os.environ.get('KG_OUTPUT_DIR', os.path.join(os.path.dirname(os.path.dirname(os.path.abspath(__file__))), ""))
```
And update `run_extraction.py` to accept `--output-dir` and set the env var.

---

## 1.5: Create templates (14 files)

**Source:** Existing templates in `docs/` for structure reference, but create clean versions.

| Target | Content |
|--------|---------|
| `core/templates/knowledge/patterns.md` | Empty structure + "Add your patterns here" instructions |
| `core/templates/knowledge/gotchas.md` | Empty structure + instructions |
| `core/templates/knowledge/concepts.md` | Empty structure + instructions |
| `core/templates/knowledge/architecture.md` | Empty structure + instructions |
| `core/templates/knowledge/workflows.md` | Empty structure + instructions |
| `core/templates/knowledge/index.md` | Master navigation hub template |
| `core/templates/knowledge/entry-template.md` | Template for new KG entries |
| `core/templates/lessons-learned/README.md` | Master index template |
| `core/templates/lessons-learned/lesson-template.md` | With git metadata YAML frontmatter |
| `core/templates/decisions/README.md` | ADR index template |
| `core/templates/decisions/ADR-template.md` | Standard ADR format |
| `core/templates/meta-issue/*` (5 files) | Based on ADR-008 structure |
| `core/templates/sessions/session-template.md` | Session summary template |
| `core/templates/MEMORY-template.md` | Starter MEMORY.md with sections (no content) |

---

## 1.6: Create hooks and subagent

- `hooks/hooks.json` — SessionStart memory check
- `scripts/check-memory.sh` — Memory validation script (portable macOS + Linux)
- `agents/knowledge-reviewer.md` — KG quality review subagent

---

## 1.7: Create phase plan files

Extract Phases 2-5 from master plan into individual files in `docs/plans/`:
- `v9.5.0-phase-2-new-skills.md`
- `v9.5.0-phase-3-examples-docs.md`
- `v9.5.0-phase-4-mcp-server.md`
- `v9.5.0-phase-5-publish.md`

(This step is being done now during planning, so skip if already complete.)

---

## 1.8: Create ROADMAP.md

Create `ROADMAP.md` at plugin root with future considerations:
- Skill aliases / short commands
- Per-project config overrides
- Backup before destructive operations
- Large KG performance (index-based search)
- Archival / superseding entries
- Config schema migration
- Cross-repo knowledge graphs
- Additional MCP tools (kg_git_metadata, kg_link_issue, kg_extract_chat)

See master plan for full ROADMAP.md content specification.

---

## Exit Criteria

- [ ] `claude --plugin-dir ./knowledge-graph-plugin` loads without errors
- [ ] All 8 ported skills appear in skill menu
- [ ] `/knowledge:capture-lesson` creates a lesson file
- [ ] `/knowledge:recall` searches across docs
- [ ] `/knowledge:extract-chat` runs Python scripts successfully
- [ ] SessionStart hook fires
- [ ] No project-specific references in ported skills (spot check)
- [ ] Phase plan files exist in `docs/plans/`
- [ ] ROADMAP.md exists with future considerations
- [ ] Copy - `v9.5.0-master-plan.md` to knowledge-graph-plugin/docs/plans/
- [ ] Copy - `v9.5.0-phase-1-foundation.md` to knowledge-graph-plugin/docs/plans/
- [ ] Copy - `v9.5.0-phase-2-new-skills.md` to knowledge-graph-plugin/docs/plans/
- [ ] Copy - `v9.5.0-phase-3-examples-docs.md` to knowledge-graph-plugin/docs/plans/
- [ ] Copy - `v9.5.0-phase-4-mcp-server.md` to knowledge-graph-plugin/docs/plans/
- [ ] Copy - `v9.5.0-phase-5-publish.md` to knowledge-graph-plugin/docs/plans/


