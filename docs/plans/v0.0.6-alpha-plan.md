# v0.0.6-alpha Release Plan

## Context

When users install the plugin from the Claude Code marketplace, the entire repository is
copied to their machine — including `docs/` which contains the plugin developer's private
knowledge graph (decisions, lessons-learned, knowledge entries). These files are irrelevant
and potentially confusing to end users.

The npm-standard solution is a `files` allowlist in `package.json` that whitelists only
plugin runtime files. `docs/` stays in git exactly as-is; it is simply not in the allowlist
so the installer skips it. No directory rename needed.

**Additional fix included:** The `kg-config.json` `knowledge-plugin-dev` graph path still
points to the old repo name (`knowledge-graph-plugin/docs`). The repo was renamed to
`knowledge-graph` in v0.0.3 but config was never updated.

Version bump: `0.0.5-alpha` → `0.0.6-alpha`

---

## Implementation Checklist

- [x] 0. Create git branch `v0.0.6-alpha` from `main`
- [x] 1. Create root `package.json` with `files` allowlist
- [x] 2. Fix stale `kg-config.json` path (`knowledge-graph-plugin/docs` → `knowledge-graph/docs`)
- [x] 2.5. Audit project for other broken/legacy path references
- [x] 3. Bump versions in `plugin.json` and `marketplace.json`
- [x] 4. Update `README.md` — add dev vs. distribution table + version bump
- [x] 5. Add `CHANGELOG.md` entry for v0.0.6-alpha
- [x] 6. Update `ROADMAP.md` with v0.0.6-alpha section and footer
- [x] 7. Sync `docs/plans/v0.0.6-alpha-plan.md` with final plan content

---

## Changes

### 1. Create root package.json with files allowlist

**File:** `/package.json` (new — does not conflict with `mcp-server/package.json`)

```json
{
  "name": "knowledge-graph-plugin",
  "version": "0.0.6-alpha",
  "description": "Structured knowledge capture and cross-session memory for Claude Code projects.",
  "files": [
    ".claude-plugin/",
    "commands/",
    "skills/",
    "agents/",
    "hooks/",
    "scripts/",
    "mcp-server/dist/",
    "core/",
    "config/",
    "README.md",
    "CHANGELOG.md",
    "LICENSE"
  ],
  "keywords": ["claude-code", "plugin", "knowledge-graph", "lessons-learned", "memory"],
  "license": "MIT",
  "repository": {
    "type": "git",
    "url": "https://github.com/technomensch/knowledge-graph.git"
  },
  "author": {
    "name": "technomensch",
    "url": "https://github.com/technomensch"
  }
}
```

**What this excludes from distribution (not in the allowlist):**
- `docs/` — Plugin developer's private KG (decisions, lessons, knowledge entries)
- `tests/` — Internal test suite
- Root development files (ROADMAP.md, etc.)

`docs/` remains in git unchanged. No renames, no path updates to commands or scripts.

---

### 2. Fix stale kg-config.json path

**File:** `~/.claude/kg-config.json` (local, not in repo)

Current value:
```
"path": "/Users/mkaplan/Documents/GitHub/knowledge-graph-plugin/docs"
```

Update to:
```
"path": "/Users/mkaplan/Documents/GitHub/knowledge-graph/docs"
```

```bash
python3 -c "
import json
path = '$HOME/.claude/kg-config.json'
with open(path) as f:
    d = json.load(f)
d['graphs']['knowledge-plugin-dev']['path'] = '/Users/mkaplan/Documents/GitHub/knowledge-graph/docs'
with open(path, 'w') as f:
    json.dump(d, f, indent=2)
print('Updated')
"
```

---

### 2.5. Audit project for broken/legacy path references

Scan the entire repo for references to the old repo name and any other stale paths.

```bash
# Search for old repo name in tracked files
grep -r "knowledge-graph-plugin" . \
  --include="*.json" --include="*.md" --include="*.sh" --include="*.ts" \
  -n

# Search in ~/.claude/ configs
grep -rn "knowledge-graph-plugin" ~/.claude/ 2>/dev/null
```

**Known instance (fixed in step 2):** `kg-config.json` `knowledge-plugin-dev` graph path.

**What to check:**
- All `.md` files in `commands/`, `skills/`, `agents/` for hardcoded old repo paths
- `hooks/hooks.json` and `scripts/` shell scripts for old path references
- `.claude-plugin/plugin.json` and `marketplace.json`
- `mcp-server/` source files for any hardcoded paths
- `README.md`, `CHANGELOG.md`, `ROADMAP.md` for stale repo name references

**Fix any found:** Update inline, note each fix in the CHANGELOG under `### Fixed`.

---

### 3. Version bump config files

- `.claude-plugin/plugin.json`: `"0.0.5-alpha"` → `"0.0.6-alpha"`
- `.claude-plugin/marketplace.json` inner plugin entry: `"0.0.5-alpha"` → `"0.0.6-alpha"`

---

### 4. README.md updates

**Version/status header:**
```
(v0.0.5-alpha) → (v0.0.6-alpha)
Status: Validation & Issue Tracking Release → Distribution Hygiene Release
```

**Add developer vs. distribution table** (after the directory tree section):
```markdown
### Developer vs. Distribution Structure

The root `package.json` `files` allowlist controls what is distributed when the plugin
is installed from the marketplace. Developer-only content in `docs/` is excluded:

| Directory    | In git | Distributed | Purpose                          |
|--------------|--------|-------------|----------------------------------|
| `commands/`  | ✅     | ✅          | Plugin commands                  |
| `skills/`    | ✅     | ✅          | Plugin skills                    |
| `core/`      | ✅     | ✅          | Platform-agnostic templates      |
| `scripts/`   | ✅     | ✅          | Hook scripts                     |
| `docs/`      | ✅     | ❌          | Plugin developer knowledge graph |
| `tests/`     | ✅     | ❌          | Internal test suite              |
```

**What's New in v0.0.6:**
```markdown
**What's New in v0.0.6:**
- Root `package.json` with `files` allowlist — `docs/`, `tests/` excluded from
  marketplace distribution (npm-standard distribution hygiene)
- Fixed stale `kg-config.json` path (knowledge-graph-plugin → knowledge-graph)
- Added developer vs. distribution table to README
```

**Update current release line:** `v0.0.5-alpha → v0.0.6-alpha`

---

### 5. CHANGELOG.md entry

Insert after `## [Unreleased]`, before `## [0.0.5-alpha]`:

```markdown
## [0.0.6-alpha] - 2026-02-17

### Added
- Root `package.json` with `files` allowlist — implements npm-standard distribution
  hygiene so marketplace-installed plugin excludes developer-only content:
  - `docs/` (plugin developer's knowledge graph: decisions, lessons, KG entries)
  - `tests/` (internal test suite)
  - Root development files (ROADMAP.md, etc.)
  `docs/` directory remains in git unchanged; no path changes to commands or scripts.

### Fixed
- Stale `kg-config.json` path: `knowledge-graph-plugin/docs` → `knowledge-graph/docs`
  (repo was renamed in v0.0.3 but local config was never updated)

### Documentation
- Added developer vs. distribution table to README.md
- Updated ROADMAP.md with v0.0.6-alpha section

**Version**: 0.0.5-alpha → 0.0.6-alpha
```

---

### 6. ROADMAP.md updates

Insert new `v0.0.6-alpha` section after the v0.0.5-alpha block:

```markdown
## v0.0.6-alpha (Released: 2026-02-17)

**Status**: ✅ Complete - Distribution Hygiene Release
**Branch**: `v0.0.6-alpha`

### Scope: files allowlist for clean marketplace distribution

- ✅ Root `package.json` with `files` allowlist (npm-standard distribution hygiene)
- ✅ `docs/` excluded from distribution without any directory rename
- ✅ Fixed stale `kg-config.json` path (knowledge-graph-plugin → knowledge-graph)
- ✅ Added developer vs. distribution table to README

### Deferred to v0.0.7
- Plugin name consolidation `"knowledge"` → `"knowledge-graph"`
- grep+sed → jq refactor in hook scripts

### Key Deliverables
- **Distribution size**: Reduced by excluding docs/, tests/ from installed package
- **No breaking changes**: docs/ path unchanged; all commands and scripts unaffected
```

Update footer:
```
Old: *Last updated: 2026-02-17*  /  *Plugin Version: 0.0.5-alpha*
New: *Last updated: 2026-02-17*  /  *Plugin Version: 0.0.6-alpha*
```

---

## Deferred (not in this release)

- **Directory rename** (`docs/` → `dev-docs/`): Not needed — the `files` allowlist
  handles distribution exclusion without touching paths. All commands and scripts
  that reference `docs/` continue to work.
- **Plugin name rename** (`"knowledge"` → `"knowledge-graph"`): Defer to v0.0.7.
- **grep+sed → jq refactor**: Defer to v0.0.7.

---

## Verification

```bash
# Confirm package.json exists with files field
cat package.json | python3 -m json.tool | grep -A 15 '"files"'

# Confirm kg-config updated
python3 -c "import json; d=json.load(open('$HOME/.claude/kg-config.json')); \
  print(d['graphs']['knowledge-plugin-dev']['path'])"
# Expected: /Users/mkaplan/Documents/GitHub/knowledge-graph/docs

# Confirm docs/ is still intact (unchanged)
ls docs/decisions/ && ls docs/knowledge/ && ls docs/lessons-learned/

# Confirm version bumps
grep '"version"' .claude-plugin/plugin.json .claude-plugin/marketplace.json
```
