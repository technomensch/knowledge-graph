# Knowledge Graph Plugin for Claude Code ‚Äî Master Plan

> **Note on versioning:** This plan originated as v9.5.0 in the optimize-my-resume project, but the plugin has its own versioning starting at **v1.0.0**. The v9.5.0 label is only relevant to the source project's changelog.

## Plan File Structure

This master plan contains the architecture, specifications, and reference material. Each implementation phase has its own plan file for focused execution across sessions:

| File | Purpose | Session | Agent |
|------|---------|---------|-------|
| **`master-plan.md`** (this file) | Architecture, skill specs, config schemas, design principles | Reference | All |
| **`phase-1-foundation.md`** | Scaffold + 8 ported skills + scripts + templates + hooks | Session 1 | Claude Code |
| **`phase-2-new-skills.md`** | 7 new skills from scratch | Session 2 | Claude Code |
| **`phase-3-examples-docs.md`** | 30 examples + 10 docs (self-contained for Antigravity) | Session 2 | Opus/Antigravity |
| **`phase-4-mcp-server.md`** | MCP data layer (7 tools + 2 resources) | Session 2-3 | Claude Code |
| **`phase-5-publish.md`** | Sanitization + testing + extract + publish | Session 3-4 | Claude Code |

**Current location:** `optimize-my-resume/docs/plans/v9.5.0-*` (temporary ‚Äî tied to source project)
**After Phase 1:** Move plans into `knowledge-graph-plugin/docs/plans/` and drop the `v9.5.0-` prefix. The plugin repo is the plans' permanent home.

**Phases 2, 3, 4** can run in parallel (no file conflicts).
**Phase 5** depends on all prior phases completing.

---

## Context

**Why this change:** The knowledge graph infrastructure built across v9.3.x-v9.4.0 (lessons-learned, KG entries, MEMORY.md sync, meta-issue tracking, chat extraction, session summaries) is domain-agnostic. Packaging it as a Claude Code plugin makes it reusable across any project ‚Äî not just resume optimization.

**What prompted it:** v9.4.0 completed the skills restructure with prefix naming. The `know-*`, `doc-*`, and governance patterns are cleanly separated from `proj-*` domain logic. The infrastructure is ready to extract.

**Intended outcome:** A published Claude Code plugin + MCP server that any developer can install to get:
- Structured lesson-learned capture with categorized storage
- Knowledge graph with quick-reference entries linked to full lessons
- MEMORY.md bidirectional sync (persistent cross-session context)
- Meta-issue tracking for complex multi-attempt problems
- Automated knowledge sync pipeline (4 steps ‚Üí 1 command)
- Chat history extraction (Claude + Gemini)
- Session summary generation
- ADR (Architecture Decision Record) management
- Recall/search across all memory systems
- **MCP tools for cross-platform use** (Cursor, Continue.dev, Cline, Claude Desktop)

---

## Key Benefits of Core + Automation Architecture

1. **Claude Code users get full automation**: Install plugin ‚Üí Run `/knowledge:init` ‚Üí `/knowledge:capture-lesson` ‚Üí Everything scaffolded automatically
2. **Local LLM users get the core system**: Clone repo ‚Üí Copy `core/` ‚Üí Follow manual workflows in `core/docs/WORKFLOWS.md`
3. **Other IDE users can adapt**: Fork repo ‚Üí Keep `core/` ‚Üí Replace Claude skills with Cursor rules / Continue commands / Aider scripts
4. **No vendor lock-in**: The knowledge graph structure (templates, examples, docs) is pure markdown. Platform-agnostic.
5. **Future-proof**: As new AI coding assistants emerge, they can reuse the core without starting from scratch

**Target Audiences:**
- **Primary (v1.0)**: Claude Code users ‚Üí Get everything via plugin
- **Secondary (documented)**: Users of local LLMs, Cursor, Continue.dev, Aider ‚Üí Use `core/` manually
- **Tertiary (future)**: Platform adapter developers ‚Üí Fork and create integrations for their tools

---

## Design Principles: Framework vs. Content

### 1. **Clear Separation: Framework ‚â† Content**
- **Plugin provides**: Structure, templates, automation tools, best practices documentation
- **Users provide**: Their own lessons learned, patterns, gotchas, insights specific to their project
- **Examples in plugin**: Illustrative ONLY, not prescriptive. Demonstrate usage, not project history.

### 2. **Privacy & Security by Default**
- **No personal information**: Examples contain no real names, emails, company details, or credentials
- **No sensitive data**: Examples use generic placeholders (`api.example.com`, not real endpoints)
- **Sanitization guidance**: Documentation includes privacy checklist and pre-commit hook example
- **User responsibility**: Each project must review their own KG entries before public sharing

### 3. **Abstraction & Generalization**
- **Patterns, not specifics**: "When debugging authentication..." not "When debugging Auth0 for Acme Corp..."
- **Generic terminology**: Examples use "output optimization" not "resume optimization"
- **Reusable insights**: Focus on transferable knowledge, not project archaeology
- **Collaboration-friendly**: Contributors can add insights without needing full project context

### 4. **Examples vs. Default Setup**
- **Setup script behavior**: Copies templates ONLY, does NOT copy examples
- **Examples location**: Remain in plugin (`core/examples/`) for reference
- **User opt-in**: Users explicitly choose to copy examples if desired
- **Clear marking**: All examples have `<!-- THIS IS AN EXAMPLE -->` header

### 5. **Open Source & Collaborative**
- **Multiple contributors**: Make it easy for team members to add lessons without coordination overhead
- **Knowledge sharing culture**: Foster continuous learning within projects that adopt the plugin
- **Best practices embedded**: PATTERNS-GUIDE.md teaches how to write good abstract entries
- **No project lock-in**: KG structure works across projects, not tied to original use case

---

## Plugin Architecture

### Name: `knowledge`

### Design Philosophy: Core + Automation Layer

**Portability Strategy:** The knowledge graph system is designed with a **platform-agnostic core** wrapped in a **Claude Code automation layer**. This means:
- **Core** (`core/`): Pure markdown templates, examples, and conceptual documentation. No Claude-specific syntax. Works with ANY LLM (local, Claude, GPT, Gemini) or IDE (VSCode, Cursor, JetBrains).
- **Automation Layer** (root-level `skills/`, `hooks/`, etc.): Claude Code-specific integration that automates the core workflows via skills and hooks.

**For users this means:**
- **Using Claude Code?** ‚Üí Install the plugin normally: `/plugin install knowledge`. Get automated skills like `/knowledge:capture-lesson`.
- **Using a local LLM or different IDE?** ‚Üí Clone the repo, copy `core/` to your project, manually follow workflows documented in `core/docs/WORKFLOWS.md`.
- **Want to adapt for another platform (Continue.dev, Cursor, Aider)?** ‚Üí Fork the repo, keep `core/`, replace Claude Code skills/hooks with your platform's automation primitives.

**Plugin Installation Model:**
The `.claude-plugin/plugin.json` lives at the repository root, making this a standard Claude Code plugin. The `core/` folder is an internal organizational choice that also serves as a portability layer.

---

### File Structure

```
knowledge-graph-plugin/                # ‚Üê Claude Code plugin (install root)
‚îÇ
‚îú‚îÄ‚îÄ .claude-plugin/
‚îÇ   ‚îî‚îÄ‚îÄ plugin.json                    # Plugin manifest (Claude Code discovers this at root)
‚îÇ
‚îú‚îÄ‚îÄ skills/                            # üîå CLAUDE CODE AUTOMATION LAYER
‚îÇ   ‚îú‚îÄ‚îÄ init/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ SKILL.md                   # /knowledge:init (wizard-based setup)
‚îÇ   ‚îú‚îÄ‚îÄ list/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ SKILL.md                   # /knowledge:list (show all configured KGs)
‚îÇ   ‚îú‚îÄ‚îÄ switch/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ SKILL.md                   # /knowledge:switch (change active KG)
‚îÇ   ‚îú‚îÄ‚îÄ add-category/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ SKILL.md                   # /knowledge:add-category (extend KG structure)
‚îÇ   ‚îú‚îÄ‚îÄ configure-sanitization/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ SKILL.md                   # /knowledge:configure-sanitization (user pre-commit setup)
‚îÇ   ‚îú‚îÄ‚îÄ check-sensitive/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ SKILL.md                   # /knowledge:check-sensitive (scan for sensitive data)
‚îÇ   ‚îú‚îÄ‚îÄ link-issue/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ SKILL.md                   # /knowledge:link-issue (link lesson to GitHub issue)
‚îÇ   ‚îú‚îÄ‚îÄ capture-lesson/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ SKILL.md                   # /knowledge:capture-lesson (with git metadata)
‚îÇ   ‚îú‚îÄ‚îÄ recall/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ SKILL.md                   # /knowledge:recall
‚îÇ   ‚îú‚îÄ‚îÄ update-graph/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ SKILL.md                   # /knowledge:update-graph
‚îÇ   ‚îú‚îÄ‚îÄ sync-all/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ SKILL.md                   # /knowledge:sync-all
‚îÇ   ‚îú‚îÄ‚îÄ update-issue-plan/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ SKILL.md                   # /knowledge:update-issue-plan (with PR integration)
‚îÇ   ‚îú‚îÄ‚îÄ session-summary/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ SKILL.md                   # /knowledge:session-summary
‚îÇ   ‚îú‚îÄ‚îÄ extract-chat/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ SKILL.md                   # /knowledge:extract-chat
‚îÇ   ‚îú‚îÄ‚îÄ meta-issue/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ SKILL.md                   # /knowledge:meta-issue
‚îÇ   ‚îî‚îÄ‚îÄ status/
‚îÇ       ‚îî‚îÄ‚îÄ SKILL.md                   # /knowledge:status (active KG info + quick reference)
‚îÇ
‚îú‚îÄ‚îÄ agents/
‚îÇ   ‚îî‚îÄ‚îÄ knowledge-reviewer.md          # Subagent for KG entry quality review
‚îÇ
‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îî‚îÄ‚îÄ hooks.json                     # SessionStart: memory check, PostToolUse: lesson suggestions
‚îÇ
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îî‚îÄ‚îÄ kg-config-template.json        # Template for ~/.claude/kg-config.json (tracks multiple KGs)
‚îÇ
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îú‚îÄ‚îÄ check-memory.sh                # Hook script for SessionStart (Claude-specific)
‚îÇ   ‚îú‚îÄ‚îÄ prepare-mcp.sh                 # MCP server build helper (checks Node.js, installs deps, builds)
‚îÇ   ‚îî‚îÄ‚îÄ validate-plugin.sh             # Pre-publish sanitization check (scans for project-specific terms)
‚îÇ
‚îú‚îÄ‚îÄ docs/
‚îÇ   ‚îî‚îÄ‚îÄ SETUP.md                       # Post-install instructions (Claude Code specific)
‚îÇ
‚îú‚îÄ‚îÄ core/                              # ‚≠ê PLATFORM-AGNOSTIC CORE
‚îÇ   ‚îú‚îÄ‚îÄ README.md                      # How to use without Claude Code (manual workflows)
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ templates/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ knowledge/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ patterns.md            # KG patterns template (empty + instructions)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ gotchas.md             # KG gotchas template (empty + instructions)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ concepts.md            # KG concepts template (empty + instructions)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ architecture.md        # KG architecture template (empty + instructions)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ workflows.md           # KG workflows template (empty + instructions)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.md               # Master navigation hub template
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ entry-template.md      # Template for new KG entries
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ lessons-learned/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ README.md              # Master index template
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ lesson-template.md     # Template for new lessons
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ decisions/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ README.md              # ADR index template
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ADR-template.md        # Template for new ADRs
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ meta-issue/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ README.md              # Navigation hub template
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ description.md         # Living document template
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ implementation-log.md  # Attempt timeline template
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ test-cases.md          # Validation criteria template
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ attempt-template/
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ solution-approach.md
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ attempt-results.md
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ sessions/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ session-template.md    # Session summary template
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ MEMORY-template.md         # Starter MEMORY.md for new projects
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ examples/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ lessons-learned/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ architecture/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Example_Three_Tier_Sync.md           # Generalized from Shadow Sync
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Example_Claude_Code_Skills_Arch.md   # Skill discovery patterns
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ process/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Example_LLM_Constraint_Patterns.md   # Generalized from enforcement
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Example_SessionStart_Automation.md   # Hook-based automation
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Example_Identifier_Decoupling.md     # Dual-ID policy
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Example_Agentic_Momentum.md          # Metric-Only Reporting
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ patterns/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Example_Memory_System_Foundation.md  # Four-Pillar origin story
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ debugging/
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ Example_Multi_Platform_Debugging.md  # Generalized
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ knowledge/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ sample-patterns.md     # 12 reusable patterns (see Section below)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ sample-concepts.md     # 6 reusable concepts (see Section below)
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ sample-gotchas.md      # 6 reusable gotchas (see Section below)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ decisions/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ADR-001-example.md     # Example ADR (dual-format documentation)
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ADR-002-example.md     # Example ADR (bidirectional KG-memory sync)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ meta-issue/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ example-performance-saga/  # Generalized from enforcement saga
‚îÇ   ‚îÇ           ‚îú‚îÄ‚îÄ README.md
‚îÇ   ‚îÇ           ‚îú‚îÄ‚îÄ description.md
‚îÇ   ‚îÇ           ‚îî‚îÄ‚îÄ attempts/
‚îÇ   ‚îÇ               ‚îú‚îÄ‚îÄ 001-baseline/
‚îÇ   ‚îÇ               ‚îî‚îÄ‚îÄ 002-caching/
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ extract_claude.py          # Claude JSONL extraction (platform-agnostic)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ extract_gemini.py          # Gemini JSON/Protobuf extraction
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ chat_extractor_base.py     # Shared utilities
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ run_extraction.py          # Master controller
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ requirements.txt           # Python dependencies (stdlib only)
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ examples-hooks/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ pre-commit-sanitization.sh # Optional pre-commit hook for sensitive data checks
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ docs/
‚îÇ       ‚îú‚îÄ‚îÄ ARCHITECTURE.md            # How the KG system works (conceptual)
‚îÇ       ‚îú‚îÄ‚îÄ PATTERNS-GUIDE.md          # Writing good KG entries + abstraction best practices
‚îÇ       ‚îú‚îÄ‚îÄ WORKFLOWS.md               # Manual workflows (for non-Claude users)
‚îÇ       ‚îú‚îÄ‚îÄ META-ISSUE-GUIDE.md        # When/how to use meta-issue tracking
‚îÇ       ‚îú‚îÄ‚îÄ SANITIZATION-CHECKLIST.md  # Privacy checklist before public sharing
‚îÇ       ‚îî‚îÄ‚îÄ PLATFORM-ADAPTATION.md     # How to adapt core for Continue/Cursor/Aider/local LLMs
‚îÇ
‚îú‚îÄ‚îÄ mcp-server/                        # üîå MCP DATA LAYER (Phase 4)
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.ts                   # MCP server entry point
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tools/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config.ts              # kg_config_init, kg_config_list, kg_config_switch, kg_config_add_category
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ search.ts             # kg_search (full-text across KG files)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ scaffold.ts           # kg_scaffold (create from templates)
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ sanitization.ts       # kg_check_sensitive
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ resources/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ config.ts              # kg://config resource
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ templates.ts           # kg://templates/{name} resource
‚îÇ   ‚îú‚îÄ‚îÄ package.json
‚îÇ   ‚îî‚îÄ‚îÄ tsconfig.json
‚îÇ
‚îú‚îÄ‚îÄ README.md                          # Plugin overview, installation, portability info
‚îú‚îÄ‚îÄ LICENSE                            # MIT
‚îî‚îÄ‚îÄ CHANGELOG.md
```

**Key Path Strategy:**
- Core templates: `${CLAUDE_PLUGIN_ROOT}/core/templates/`
- Skills reference core templates via this path
- Setup script copies from `core/templates/` to project `docs/`
- Examples ship in `core/examples/` (no Claude-specific syntax)
- Non-Claude users: `git clone` ‚Üí copy `core/` ‚Üí follow `core/docs/WORKFLOWS.md`

---

## Plugin Manifest

**File: `.claude-plugin/plugin.json`**
```json
{
  "name": "knowledge",
  "version": "1.0.0",
  "description": "Structured knowledge capture, lesson-learned documentation, and cross-session memory for Claude Code projects. Includes KG entries, ADRs, meta-issue tracking, chat extraction, and MEMORY.md bidirectional sync.",
  "author": {
    "name": "technomensch",
    "url": "https://github.com/technomensch"
  },
  "repository": "https://github.com/technomensch/knowledge-graph-plugin",
  "license": "MIT",
  "keywords": [
    "knowledge",
    "lessons-learned",
    "memory",
    "documentation",
    "governance",
    "meta-issue",
    "adr"
  ],
  "hooks": "./hooks/hooks.json"
}
```

---

## Skills (16 total)

### 1. `/knowledge:init` ‚≠ê NEW
**Source:** NEW skill
**What it does:** Wizard-based knowledge graph initialization with flexible configuration.
**Wizard prompts:**
1. **KG Location**: Where to store?
   - Project-local (`./docs/`)
   - Global topic-based (`~/.claude/knowledge-graphs/[name]/`)
   - Claude Cowork (`~/.claude/cowork-knowledge/[topic]/`)
   - Custom path
2. **KG Name**: Identifier for this knowledge graph (e.g., "my-project", "ai-research", "devops-patterns")
3. **Categories**: Select from defaults (architecture, process, patterns, debugging, governance) or add custom
4. **Git Strategy**:
   - All committed (public knowledge sharing)
   - All gitignored (private notes only)
   - Selective (choose which categories to commit)
5. **Custom Prefix**: If adding custom categories, what prefix? (e.g., "sec-" for security categories)

**Creates:**
- KG directory structure based on selections
- Config entry in `~/.claude/kg-config.json` tracking this KG
- `.gitignore` entries based on git strategy
- Category-specific subdirectories
- Sets this KG as "active"

### 2. `/knowledge:list` ‚≠ê NEW
**Source:** NEW skill
**What it does:** Display all configured knowledge graphs from `~/.claude/kg-config.json`.
**Output:**
```
Knowledge Graphs:
1. my-project (active) ‚Äî /Users/name/projects/my-app/docs/
   Categories: architecture, process, patterns
   Git: selective (architecture committed, process gitignored)
2. ai-research ‚Äî ~/.claude/knowledge-graphs/ai-research/
   Categories: architecture, process, ml-patterns (custom)
   Git: all committed
3. cowork-devops ‚Äî ~/.claude/cowork-knowledge/devops/
   Categories: governance, debugging
   Git: all gitignored
```

### 3. `/knowledge:switch` ‚≠ê NEW
**Source:** NEW skill
**What it does:** Change the active knowledge graph.
**Syntax:**
```
/knowledge:switch my-project
/knowledge:switch ai-research
```
Updates active KG in config. Subsequent `capture-lesson`, `update-graph`, etc. use the active KG.

### 4. `/knowledge:add-category` ‚≠ê NEW
**Source:** NEW skill
**What it does:** Add a new category to an existing knowledge graph.
**Wizard prompts:**
1. **Category Name**: e.g., "security", "ml-ops", "compliance"
2. **Prefix** (if needed): e.g., "sec-", "ml-", "comp-"
3. **Git Strategy**: Commit or gitignore this category?

**Creates:**
- New category subdirectory in `lessons-learned/[category]/`
- New KG entry file `knowledge/[category].md` if needed
- Updates config with new category
- Updates `.gitignore` if needed

### 5. `/knowledge:configure-sanitization` ‚≠ê NEW
**Source:** NEW skill
**What it does:** Interactive wizard to help users set up pre-commit hooks for sensitive data detection.
**Wizard prompts:**
1. **Scan patterns**: Select what to scan for (emails, API keys, personal names, company names, internal URLs)
2. **Custom patterns**: Add project-specific patterns to block (e.g., "ACME Corp", "internal.company.com")
3. **Action on match**: Warn or block commit?
4. **Install hook?**: Copy pre-commit script to `.git/hooks/`

**Creates:**
- `.git/hooks/pre-commit` script (based on `core/examples-hooks/pre-commit-sanitization.sh`)
- `.claude/sanitization-config.json` with custom patterns
- Makes hook executable
- Tests hook with dry run

### 6. `/knowledge:check-sensitive` ‚≠ê NEW
**Source:** NEW skill
**What it does:** Scan active KG for potentially sensitive information before public sharing.
**Scans for:**
- Email addresses
- Personal names (from git commits)
- API endpoints (http://, https:// patterns)
- Common secret patterns (API_KEY=, password=, token=)
- Custom patterns from `.claude/sanitization-config.json`

**Output:**
```
‚ö†Ô∏è Potential sensitive data found:
- docs/lessons-learned/process/debugging-auth.md:42 ‚Äî email: john@company.com
- docs/knowledge/patterns.md:15 ‚Äî URL: https://api.internal.company.com
Review these entries before pushing to public repository.
```

### 7. `/knowledge:link-issue` ‚≠ê NEW
**Source:** NEW skill
**What it does:** Manually link existing lesson/ADR to a GitHub issue with bidirectional references.
**Syntax:**
```
/knowledge:link-issue docs/lessons-learned/process/my-lesson.md --issue 42
/knowledge:link-issue docs/decisions/ADR-005.md --issue 38 --pr 40
```
**Actions:**
1. Read existing lesson/ADR file
2. Update frontmatter with issue/PR metadata
3. If GitHub enabled: Post comment to issue with lesson link
4. Update KG entry (if exists) with issue reference
5. Verify bidirectional link created

**GitHub comment format:**
```markdown
üìö Lesson Learned: [Title](link-to-file)

A lesson has been documented for this issue.
- Branch: {branch}
- Commit: {commit}
- Category: {category}

See: docs/lessons-learned/process/my-lesson.md
```

### 8. `/knowledge:capture-lesson` ‚ö†Ô∏è ENHANCED
**Source:** `know-capture-lesson.md` (generalized + git metadata)
**What it does:** Create/update lesson-learned documents with category auto-detection, master index update, KG sync trigger, **and automatic git metadata capture**.

**New git metadata features:**
1. Auto-detect current branch, commit hash, author
2. Check for associated PR via `gh pr list --head $(branch)` (if gh CLI available)
3. Prompt for issue number or auto-detect from branch name (e.g., `fix/issue-41-auth` ‚Üí issue #41)
4. Insert metadata in YAML frontmatter
5. If issue specified + GitHub enabled ‚Üí Post comment to issue with lesson link

**Generalization needed:**
- Remove resume/enforcement references from examples
- Replace project-specific categories with generic defaults (architecture, debugging, process, patterns)
- Keep Step 7 MEMORY.md sync protocol
- Keep `--auto-sync` flag for triggering `/knowledge:sync-all`
- Add git metadata capture (configurable, disabled if git not available)

### 9. `/knowledge:recall`
**Source:** `know-recall.md` (generalized)
**What it does:** Full-text search across lessons, KG entries, ADRs, sessions, and MEMORY.md in the **active** KG.
**Generalization needed:**
- Read KG location from `~/.claude/kg-config.json` (active KG)
- Keep 4 output formats (summary/paths/detailed/none)
- Keep suggestion engine

### 10. `/knowledge:update-graph` ‚ö†Ô∏è ENHANCED
**Source:** `know-update-graph.md` (generalized + git metadata preservation)
**What it does:** Extract structured insights from lessons and create/update KG entries with bidirectional links **preserving git metadata**.
**Generalization needed:**
- Use active KG from config
- Remove project-specific extraction examples
- **Preserve lesson metadata** (branch, commit, PR, issue) in KG cross-references
- Keep 7-step process (identify ‚Üí extract ‚Üí verify ‚Üí create/update ‚Üí cross-ref ‚Üí quality check ‚Üí MEMORY.md sync)
- Keep LEVERAGE principle (KG = quick ref, lessons = deep dive)
- Keep Step 7 bidirectional sync protocol

### 11. `/knowledge:sync-all`
**Source:** `know-sync-all.md` (generalized)
**What it does:** Automated orchestrator replacing 4-step manual knowledge sync pipeline.
**Generalization needed:**
- Use active KG from config
- Remove project-specific GitHub issue references (make GitHub integration optional)
- Keep 7 workflow steps with single confirmation
- Keep idempotent design

### 12. `/knowledge:update-issue-plan` ‚ö†Ô∏è ENHANCED
**Source:** `know-update-issue-plan.md` (generalized + PR integration)
**What it does:** Sync KG extraction with active plans and local/GitHub issue tracking, **plus auto-generate PR descriptions with lesson links**.

**New PR integration features:**
1. Scan lessons created on current branch
2. Auto-generate "Related Lessons" section for PR description
3. Link PRs back to lessons in metadata
4. Update GitHub issue when PR merged with lesson links

**Generalization needed:**
- Make GitHub integration optional (some projects don't use GitHub issues)
- Keep 5-step governance loop structure
- Keep decision gates
- Add PR description generation step

### 13. `/knowledge:session-summary`
**Source:** `doc-session-summary.md` (generalized)
**What it does:** Auto-document work sessions with files touched, commits, decisions, lessons.
**Generalization needed:**
- Remove project-specific session path references
- Use active KG for session storage location
- Keep Smart Defaults (auto-detect session, include git, single confirmation)
- Keep conflict resolution (append vs new)
- Keep KG integration suggestions

### 14. `/knowledge:extract-chat`
**Source:** `proj-extract-chat.md` + Python scripts (generalized)
**What it does:** Extract chat history from Claude Code and Gemini local logs.
**Generalization needed:**
- Output to active KG's chat-history/ directory
- Make paths configurable via `--claude-dir`, `--gemini-dir`, `--output-dir` arguments
- Keep incremental append, metadata tracking, daily grouping

### 15. `/knowledge:meta-issue`
**Source:** NEW skill based on ADR-008 meta-issue pattern
**What it does:** Initialize meta-issue tracking for complex problems spanning 3+ attempts.
**Creates:** Directory structure with 5 core files, attempt folders, analysis folder in active KG.
**Syntax:**
```
/knowledge:meta-issue "Performance investigation across v2.x"
/knowledge:meta-issue --add-attempt 003 "Try connection pooling"
/knowledge:meta-issue --update-understanding "Root cause is network latency, not query speed"
```

### 16. `/knowledge:status` ‚≠ê NEW
**Source:** NEW skill
**What it does:** Display active KG status, quick reference, and available commands.
**Output:**
```
Knowledge Graph Status
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
Active KG: my-project
Location:  /Users/name/projects/my-app/docs/
Categories: architecture, process, patterns, debugging
Git: selective (architecture/patterns committed, process/debugging gitignored)
Last sync: 2026-02-12 15:45

Stats:
  Lessons: 12 (3 new since last sync)
  KG Entries: 28 patterns, 6 concepts, 4 gotchas
  ADRs: 5
  Sessions: 8

Quick Commands:
  /knowledge:capture-lesson    ‚Äî Document a lesson
  /knowledge:recall "query"    ‚Äî Search across all KG
  /knowledge:sync-all          ‚Äî Run full sync pipeline
  /knowledge:update-graph      ‚Äî Extract KG entries from lessons
  /knowledge:session-summary   ‚Äî Summarize this session
```
**Also shows:** Warning if MEMORY.md is stale, reminder if no config exists (first-run detection).

---

## Git/GitHub Integration & Metadata Tracking

### Lesson/Decision Metadata (Frontmatter)

Every lesson-learned and ADR includes git context in YAML frontmatter:

```yaml
---
title: "Lesson: Authentication Race Condition Fix"
created: 2026-02-12T16:30:00Z
author: mkaplan
email: user@example.com
git:
  branch: fix/auth-race-condition
  commit: abc123def456789
  pr: 42
  issue: 41
tags: [security, authentication, debugging]
category: process
---

## Problem
...
```

### Automatic Metadata Capture

**When `/knowledge:capture-lesson` is invoked:**
1. Auto-detect current branch: `git rev-parse --abbrev-ref HEAD`
2. Get latest commit hash: `git rev-parse HEAD`
3. Get git author: `git config user.name` + `git config user.email`
4. Check for associated PR: `gh pr list --head $(current-branch)` (if gh CLI available)
5. Prompt for issue number (or auto-detect from branch name like `fix/issue-41-auth`)
6. Insert metadata in frontmatter

**When `/knowledge:update-graph` extracts to KG:**
- Preserve source lesson metadata
- Cross-reference: "Source: [Lesson Title](path/to/lesson.md) (PR #42, Issue #41)"

### Bidirectional Linking

#### 1. **Lesson ‚Üí GitHub Issue**
When lesson is created/committed:
- If issue number in metadata ‚Üí Post comment to GitHub issue:
  ```
  üìö Lesson Learned: [Lesson Title](link-to-file)

  A lesson has been documented for this issue.
  Branch: fix/auth-race-condition
  Commit: abc123d

  See docs/lessons-learned/process/auth-race-condition-fix.md
  ```

#### 2. **PR ‚Üí Lessons**
When creating PR (via `/knowledge:update-issue-plan` or custom hook):
- Scan lessons created on this branch
- Auto-generate PR description section:
  ```markdown
  ## Related Lessons
  - [Authentication Race Condition Fix](docs/lessons-learned/process/auth-race-condition-fix.md)
  - [Async Timing Pattern](docs/knowledge/patterns.md#async-timing)
  ```

#### 3. **Issue Closure ‚Üí Lesson Check**
When issue is closed (manual or via PR merge):
- Check if lesson exists with this issue number
- If YES: Add final comment: "‚úÖ Lesson documented in [link]"
- If NO: Optionally prompt: "Document lesson learned? /knowledge:capture-lesson"

### Git Governance Integration

**From existing git-governance skills:**
1. Pre-commit hook validates lesson metadata (branch, commit populated)
2. Pre-push checks: Lessons on this branch have issue references?
3. Post-merge updates: Sync lesson status to "merged" in metadata

### New Skill: `/knowledge:link-issue`

**What it does:** Manually link existing lesson to GitHub issue
**Syntax:**
```
/knowledge:link-issue docs/lessons-learned/process/my-lesson.md --issue 42
```
**Actions:**
1. Add issue metadata to lesson frontmatter
2. Post comment to GitHub issue with lesson link
3. Update KG entry with issue reference

### Configuration

**In `kg-config.json`:**
```json
{
  "graphs": {
    "my-project": {
      "git": {
        "enabled": true,
        "trackMetadata": true,
        "autoLinkIssues": true,
        "ghCLI": true  // Use gh CLI for PR/issue lookups
      }
    }
  }
}
```

### Templates Updated

**`core/templates/lessons-learned/lesson-template.md`:**
```markdown
---
title: "LESSON_TITLE"
created: YYYY-MM-DDTHH:MM:SSZ
author: YOUR_NAME
email: your@email.com
git:
  branch: CURRENT_BRANCH
  commit: COMMIT_HASH
  pr: null  # PR number if applicable
  issue: null  # Issue number if applicable
tags: []
category: architecture|process|patterns|debugging
---

## Problem
[Describe the problem that was encountered]
...
```

---

## Knowledge Graph Configuration

**File: `~/.claude/kg-config.json`** (created by first `/knowledge:init`)

Tracks all configured knowledge graphs, their locations, categories, and git strategies.

```json
{
  "version": "1.0.0",
  "active": "my-project",
  "graphs": {
    "my-project": {
      "name": "my-project",
      "path": "/Users/name/projects/my-app/docs/",
      "type": "project-local",
      "categories": [
        { "name": "architecture", "prefix": null, "git": "commit" },
        { "name": "process", "prefix": null, "git": "ignore" },
        { "name": "patterns", "prefix": null, "git": "commit" },
        { "name": "debugging", "prefix": null, "git": "ignore" }
      ],
      "createdAt": "2026-02-12T10:30:00Z",
      "lastUsed": "2026-02-12T15:45:00Z"
    },
    "ai-research": {
      "name": "ai-research",
      "path": "/Users/name/.claude/knowledge-graphs/ai-research/",
      "type": "global-topic",
      "categories": [
        { "name": "architecture", "prefix": null, "git": "commit" },
        { "name": "process", "prefix": null, "git": "commit" },
        { "name": "ml-patterns", "prefix": "ml-", "git": "commit" }
      ],
      "createdAt": "2026-01-15T08:00:00Z",
      "lastUsed": "2026-02-10T12:00:00Z"
    },
    "cowork-devops": {
      "name": "cowork-devops",
      "path": "/Users/name/.claude/cowork-knowledge/devops/",
      "type": "claude-cowork",
      "categories": [
        { "name": "governance", "prefix": "gov-", "git": "ignore" },
        { "name": "debugging", "prefix": null, "git": "ignore" }
      ],
      "createdAt": "2026-02-01T14:20:00Z",
      "lastUsed": "2026-02-11T09:15:00Z"
    }
  },
  "sanitization": {
    "enabled": true,
    "patterns": [
      { "type": "email", "enabled": true },
      { "type": "api-key", "enabled": true },
      { "type": "custom", "pattern": "ACME Corp", "enabled": true },
      { "type": "custom", "pattern": "internal\\.company\\.com", "enabled": true }
    ],
    "action": "warn"
  }
}
```

**Key behaviors:**
- Skills always operate on the "active" graph
- `/knowledge:switch` changes the "active" field
- `/knowledge:init` adds a new entry to "graphs" and sets it as active
- Each KG can have different git strategies per-category
- Config persists across sessions and projects

---

## Hooks

**File: `hooks/hooks.json`**
```json
{
  "hooks": {
    "SessionStart": [
      {
        "matcher": "",
        "hooks": [
          {
            "type": "command",
            "command": "${CLAUDE_PLUGIN_ROOT}/scripts/check-memory.sh",
            "timeout": 5
          }
        ]
      }
    ]
  }
}
```

**`scripts/check-memory.sh`:** On session start:
1. **First-run detection:** Check if `~/.claude/kg-config.json` exists. If not ‚Üí output: "No knowledge graph configured. Run `/knowledge:init` to get started."
2. **MEMORY.md check:** If config exists, check if MEMORY.md exists and has been updated recently. If stale (>7 days since last KG sync) ‚Üí add context reminder.
3. **Active KG validation:** If config references a path that no longer exists ‚Üí warn user.

**Note:** The commit/branch validation hooks from v9.4.0 are NOT included in the plugin ‚Äî those are project-specific governance. The plugin focuses on knowledge capture, not git enforcement.

---

## Subagent

**File: `agents/knowledge-reviewer.md`**
```markdown
---
name: knowledge-reviewer
description: Reviews knowledge graph entries for quality, completeness, and proper bidirectional linking. Use when creating or updating KG entries to ensure they meet quality standards.
---

Review knowledge graph entries against these criteria:
1. Quick Reference is scannable (5-10 seconds to understand)
2. Link to lesson is correct and file exists
3. Related patterns are cross-linked (bidirectional)
4. "When to use" is actionable
5. Problem/Solution are clear
6. Correct category placement
7. Consistent formatting with other entries
8. No orphaned references
```

---

## Example Knowledge Graph Entries (Full Library ‚Äî ~30 examples)

All example files include clear `<!-- THIS IS AN EXAMPLE ‚Äî Replace with your project's patterns -->` headers.

### Sample Patterns (12 entries in `examples/knowledge/sample-patterns.md`)

| # | Pattern Name | Source | Generalization |
|---|-------------|--------|---------------|
| 1 | Multi-Tier Synchronization | Shadow Sync Protocol | High ‚Äî replace project-specific tier names with generic |
| 2 | Bidirectional Memory Sync | ADR-011 | None ‚Äî already domain-agnostic |
| 3 | Smart Defaults | v9.4.0 skill restructure | None ‚Äî already domain-agnostic |
| 4 | Automated Orchestrator | know-sync-all | Low ‚Äî replace KG-specific examples with generic pipeline |
| 5 | Meta-Issue Tracking | ADR-008 | Medium ‚Äî replace enforcement saga with performance example |
| 6 | Four-Pillar Memory | patterns.md entry | None ‚Äî THE core architecture of the plugin |
| 7 | Project Memory System | patterns.md entry | Low ‚Äî remove project-specific paths |
| 8 | Category Auto-Detection | patterns.md entry | None ‚Äî already generic keyword‚Üícategory mapping |
| 9 | Template-Driven Docs | patterns.md entry | None ‚Äî already generic document creation pattern |
| 10 | Identifier Decoupling | patterns.md entry | None ‚Äî local vs platform ID mapping applies to any project |
| 11 | Positive Constraint Framing | patterns.md entry | None ‚Äî universal LLM prompt engineering pattern |
| 12 | Functional Directory Structure | patterns.md entry | None ‚Äî generic directory naming pattern |

### Sample Concepts (6 entries in `examples/knowledge/sample-concepts.md`)

| # | Concept Name | Source | Generalization |
|---|-------------|--------|---------------|
| 1 | Memory Systems (Four-Pillar) | concepts.md | None ‚Äî core plugin concept |
| 2 | Cross-Referencing | concepts.md | None ‚Äî bidirectional linking system |
| 3 | Template-Driven Consistency | concepts.md | None ‚Äî standardization approach |
| 4 | Categorization | concepts.md | None ‚Äî knowledge organization strategy |
| 5 | Automation Strategy | concepts.md | Low ‚Äî rename skill references to plugin namespace |
| 6 | Passive vs Active Enforcement | concepts.md | Medium ‚Äî generalize guardrail examples |

### Sample Gotchas (6 entries in `examples/knowledge/sample-gotchas.md`)

| # | Gotcha Name | Source | Generalization |
|---|------------|--------|---------------|
| 1 | Agent Governance Drift | gotchas.md | None ‚Äî universal: AI skips documentation steps |
| 2 | Plan File Location | gotchas.md | None ‚Äî temp vs permanent file gotcha |
| 3 | Flat Skill Discovery Constraint | gotchas.md | None ‚Äî critical Claude Code plugin knowledge |
| 4 | HEREDOC Commit Message Parsing | gotchas.md | None ‚Äî useful for anyone writing hooks |
| 5 | The Vibe-Coding Drift | gotchas.md | Medium ‚Äî generalize resume refs to "project content" |
| 6 | Instructional Saturation | gotchas.md | Medium ‚Äî generalize examples to generic long-context |

### Sample Lessons Learned (7 files in `examples/lessons-learned/`)

| # | Lesson File | Source | Generalization |
|---|------------|--------|---------------|
| 1 | `architecture/Example_Three_Tier_Sync.md` | Shadow Sync Protocol lesson | High ‚Äî replace project tiers with generic config tiers |
| 2 | `architecture/Example_Claude_Code_Skills_Arch.md` | Skills Architecture lesson | None ‚Äî understanding skill discovery is universal |
| 3 | `process/Example_LLM_Constraint_Patterns.md` | Effective LLM Constraints | Low ‚Äî already domain-agnostic |
| 4 | `process/Example_SessionStart_Automation.md` | SessionStart Automation | Low ‚Äî rename skills to plugin namespace |
| 5 | `process/Example_Identifier_Decoupling.md` | Identifier Decoupling | None ‚Äî Dual-ID policy is universal |
| 6 | `process/Example_Agentic_Momentum.md` | Agentic Momentum Governance | Medium ‚Äî generalize resume refs to "project output" |
| 7 | `patterns/Example_Memory_System_Foundation.md` | Memory System Phase 1 | Low ‚Äî THE origin story, already mostly generic |

### Sample ADRs (2 files in `examples/decisions/`)

| # | ADR File | Source | Generalization |
|---|---------|--------|---------------|
| 1 | `ADR-001-example.md` | ADR-001 Dual-Format Documentation | None ‚Äî `.txt` for LLMs + `.md` for humans is universal |
| 2 | `ADR-002-example.md` | ADR-011 KG ‚Üî Memory Sync | None ‚Äî bidirectional sync already domain-agnostic |

### Sample Meta-Issue (1 directory in `examples/meta-issue/`)

| # | Files | Source | Generalization |
|---|-------|--------|---------------|
| 1 | `example-performance-saga/` (README, description, 2 attempts) | v9.3.x enforcement saga | High ‚Äî replace enforcement with generic performance investigation |

### Generalization Guidelines for All Examples

For each example file:
1. Add `<!-- THIS IS AN EXAMPLE -->` header with instructions to replace
2. Replace project-specific terms: "resume" ‚Üí "project output", "enforcement" ‚Üí "compliance", "optimization-tools/" ‚Üí "config-modules/"
3. Keep the structural patterns (Problem ‚Üí Root Cause ‚Üí Solution ‚Üí Replication ‚Üí Lessons)
4. Keep cross-reference patterns (link to KG entry, link to ADR, link to lesson)
5. Keep actionable "When to use" triggers
6. Preserve the LEVERAGE principle: KG = quick ref, Lesson = deep dive

---

## Post-Install Setup Guide

**File: `docs/SETUP.md`**

This is the "instructions for updating local files" markdown that runs when the plugin is installed.

### Contents:

```markdown
# Knowledge Graph Plugin - Project Setup

## Quick Start (5 minutes)

### Step 1: Initialize Your Knowledge Graph

\`\`\`
/knowledge:init
\`\`\`

The interactive wizard will guide you through:
- KG storage location (project-local, global, or custom)
- Category selection (architecture, process, patterns, debugging, etc.)
- Git strategy (commit all, gitignore all, or selective)
- MEMORY.md discovery and linking

### Step 2: Verify Setup

\`\`\`
/knowledge:status
\`\`\`

### Step 3: Create Your First Lesson

\`\`\`
/knowledge:capture-lesson
\`\`\`

## Optional: Copy Example Content

To start with example entries instead of empty templates:

\`\`\`bash
cp -r ${CLAUDE_PLUGIN_ROOT}/core/examples/knowledge/* docs/knowledge/
cp -r ${CLAUDE_PLUGIN_ROOT}/core/examples/lessons-learned/* docs/lessons-learned/
cp -r ${CLAUDE_PLUGIN_ROOT}/core/examples/decisions/* docs/decisions/
\`\`\`

## Integration with Existing Projects

If you already have docs/ or lessons-learned/ directories:
- `/knowledge:init` detects existing directories and skips them
- Manually merge templates into your existing structure
- Use `/knowledge:recall` to verify search works across your existing docs

## Team Workflows

For multi-developer projects:
- Use "selective" git strategy: commit shared patterns, gitignore personal notes
- Category conventions: agree on category names before team adoption
- Merge conflicts: KG entry files are append-friendly (new entries at bottom)
- Shared MEMORY.md: coordinate edits or use per-developer sections
```

---

## Publishing to Git

### Step 1: Create Repository

```bash
# Create the plugin repo
mkdir knowledge-graph-plugin
cd knowledge-graph-plugin
git init

# Build the plugin structure (per architecture above)
# ... create all files ...

# Validate
claude plugin validate .
```

### Step 2: Create Marketplace

Two options:

**Option A: Standalone marketplace (recommended for single plugin)**
```bash
mkdir -p .claude-plugin
# Create marketplace.json (see below)
```

**File: `.claude-plugin/marketplace.json`**
```json
{
  "name": "technomensch-tools",
  "owner": {
    "name": "technomensch",
    "email": "your@email.com"
  },
  "metadata": {
    "description": "Knowledge management tools for Claude Code",
    "version": "1.0.0"
  },
  "plugins": [
    {
      "name": "knowledge",
      "source": ".",
      "description": "Structured knowledge capture with KG, lessons, ADRs, meta-issues, and cross-session memory",
      "version": "1.0.0",
      "category": "productivity",
      "tags": ["knowledge", "documentation", "memory", "lessons-learned"],
      "license": "MIT"
    }
  ]
}
```

**Option B: Multi-plugin marketplace (future-proof)**
```
technomensch-marketplace/
‚îú‚îÄ‚îÄ .claude-plugin/
‚îÇ   ‚îî‚îÄ‚îÄ marketplace.json
‚îú‚îÄ‚îÄ plugins/
‚îÇ   ‚îî‚îÄ‚îÄ knowledge/               # The plugin lives here
‚îÇ       ‚îú‚îÄ‚îÄ .claude-plugin/
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ plugin.json
‚îÇ       ‚îú‚îÄ‚îÄ skills/
‚îÇ       ‚îî‚îÄ‚îÄ ...
‚îî‚îÄ‚îÄ README.md
```

### Step 3: Push & Publish

```bash
git add -A
git commit -m "feat: initial release of knowledge plugin v1.0.0"
git remote add origin https://github.com/technomensch/knowledge-graph-plugin.git
git push -u origin main
```

### Step 4: Users Install Via

```bash
# Add marketplace
/plugin marketplace add technomensch/knowledge-graph-plugin

# Install
/plugin install knowledge@technomensch-tools
```

### Step 5 (Optional): Submit to Official Directory

Submit at [clau.de/plugin-directory-submission](https://clau.de/plugin-directory-submission) for inclusion in `anthropics/claude-plugins-official`.

---

## Implementation Strategy: Build Locally First

**Key Principle:** Build the plugin INSIDE optimize-my-resume first, test it locally, then extract to separate repo.

**Why:**
- ‚úÖ Copy existing working files (massive token savings)
- ‚úÖ Test in real environment before extraction
- ‚úÖ Catch integration issues early
- ‚úÖ Preserve working code (no rewriting from scratch)

**Location:** `/Users/mkaplan/Documents/GitHub/knowledge-graph-plugin/` (separate repository)

---

## Implementation Phases

All 16 skills, MCP server, and ~72+ files ship as v1.0. The build is split into **5 phases across 4 calendar sessions** ‚Äî Phases 2, 3, and 4 can run in parallel.

**Repository Status:** Initialized with git, initial commit complete (8 skills, 6,567 lines)

### Dependency Graph & Parallelization

```
Phase 1: Foundation (Session 1 ‚Äî Claude Code)
   ‚Üì must complete first
   ‚îú‚îÄ‚îÄ Phase 2: New Skills        (Session 2 ‚Äî Claude Code)     ‚îÄ‚îÄ‚îê
   ‚îú‚îÄ‚îÄ Phase 3: Examples + Docs   (Session 2 ‚Äî Opus/Antigravity) ‚îÄ‚îÄ‚î§ PARALLEL
   ‚îú‚îÄ‚îÄ Phase 4: MCP Server        (Session 2 or 3 ‚Äî Claude Code) ‚îÄ‚îÄ‚îò
   ‚Üì all above must complete
Phase 5: Sanitization + Testing + Publishing (Session 3 or 4 ‚Äî Claude Code)
```

**Parallel strategy:**
- **Claude Code** handles Phases 2 + 4 (code-heavy, needs file system)
- **Opus in Antigravity** handles Phase 3 (content-heavy, pure markdown writing)
- Provide Antigravity agent with: this plan document + existing source files to generalize
- No file conflicts: skills in `skills/`, examples in `core/examples/`, docs in `core/docs/`

---

### Phase 1: Foundation (Session 1 ‚Äî Claude Code)
**Goal:** Plugin scaffold + 8 ported skills + Python scripts + templates + hooks/subagent
**Deliverable:** A locally testable plugin with all core knowledge capture skills working.

#### 1.1: Create plugin directory structure
```bash
cd /Users/mkaplan/Documents/GitHub/optimize-my-resume
mkdir -p knowledge-graph-plugin/{.claude-plugin,skills,agents,hooks,scripts,config,core/{templates,examples,scripts,docs,examples-hooks},docs}
```

#### 1.2: Create plugin scaffold
**Create new:**
- `.claude-plugin/plugin.json` ‚Äî Plugin manifest
- `config/kg-config-template.json` ‚Äî Multi-KG configuration schema
- `LICENSE` ‚Äî MIT license
- `CHANGELOG.md` ‚Äî Start at v1.0.0
- `ROADMAP.md` ‚Äî Future enhancements and known considerations (see content below)

#### 1.3: Copy existing skills ‚Üí Convert to SKILL.md format (8 skills)
**Source:** `.agent/workflows/`

| Source File | Target | Action |
|-------------|--------|--------|
| `know-capture-lesson.md` | `skills/capture-lesson/SKILL.md` | Copy + add YAML frontmatter + add git metadata capture |
| `know-recall.md` | `skills/recall/SKILL.md` | Copy + add YAML frontmatter + update paths to use config |
| `know-update-graph.md` | `skills/update-graph/SKILL.md` | Copy + add YAML frontmatter + preserve git metadata |
| `know-sync-all.md` | `skills/sync-all/SKILL.md` | Copy + add YAML frontmatter |
| `know-update-issue-plan.md` | `skills/update-issue-plan/SKILL.md` | Copy + add YAML frontmatter + add PR integration |
| `doc-session-summary.md` | `skills/session-summary/SKILL.md` | Copy + add YAML frontmatter |
| `proj-extract-chat.md` | `skills/extract-chat/SKILL.md` | Copy + add YAML frontmatter |
| NEW | `skills/meta-issue/SKILL.md` | Create based on ADR-008 pattern |

**For each copy:**
1. Add YAML frontmatter (name, description, syntax)
2. Change skill invocation from `/know-*` to `/knowledge:*`
3. Update paths to read from `~/.claude/kg-config.json` (active KG)
4. Remove project-specific examples (resume, enforcement, v9.3.x)

#### 1.4: Copy Python scripts (5 files + 1 new)
**Source:** `chat-history/scripts/`

| Source | Target | Changes |
|--------|--------|---------|
| `extract_claude.py` | `core/scripts/extract_claude.py` | Copy as-is (includes backup fix) |
| `extract_gemini.py` | `core/scripts/extract_gemini.py` | Copy as-is |
| `chat_extractor_base.py` | `core/scripts/chat_extractor_base.py` | **Fix:** Add `--output-dir` CLI arg to override `OUTPUT_DIR` |
| `run_extraction.py` | `core/scripts/run_extraction.py` | **Fix:** Add `--output-dir` passthrough arg |
| NEW | `core/scripts/requirements.txt` | `# stdlib only (blackboxprotobuf optional for Gemini protobuf)` |

**Critical fix (Opus #4):** `chat_extractor_base.py` currently derives `OUTPUT_DIR` from `os.path.dirname(__file__)`. When installed as a plugin, `__file__` resolves to the plugin cache, not the user's project. Add:
```python
# Allow override via CLI or environment
OUTPUT_DIR = os.environ.get('KG_OUTPUT_DIR', os.path.join(os.path.dirname(os.path.dirname(os.path.abspath(__file__))), ""))
```
And update `run_extraction.py` to accept `--output-dir` and set the env var.

#### 1.5: Create templates (14 files)
**Source:** Existing templates in `docs/` for structure reference, but create clean versions.

| Target | Content |
|--------|---------|
| `core/templates/knowledge/patterns.md` | Empty structure + "Add your patterns here" instructions |
| `core/templates/knowledge/gotchas.md` | Empty structure + instructions |
| `core/templates/knowledge/concepts.md` | Empty structure + instructions |
| `core/templates/knowledge/architecture.md` | Empty structure + instructions |
| `core/templates/knowledge/workflows.md` | Empty structure + instructions |
| `core/templates/knowledge/index.md` | Master navigation hub template |
| `core/templates/knowledge/entry-template.md` | Template for new KG entries |
| `core/templates/lessons-learned/README.md` | Master index template |
| `core/templates/lessons-learned/lesson-template.md` | With git metadata YAML frontmatter |
| `core/templates/decisions/README.md` | ADR index template |
| `core/templates/decisions/ADR-template.md` | Standard ADR format |
| `core/templates/meta-issue/*` (5 files) | Based on ADR-008 structure |
| `core/templates/sessions/session-template.md` | Session summary template |
| `core/templates/MEMORY-template.md` | Starter MEMORY.md with sections (no content) |

#### 1.6: Create hooks and subagent
- `hooks/hooks.json` ‚Äî SessionStart memory check
- `scripts/check-memory.sh` ‚Äî Memory validation script (portable macOS + Linux)
- `agents/knowledge-reviewer.md` ‚Äî KG quality review subagent

#### 1.8: Create ROADMAP.md

Create `ROADMAP.md` at plugin root with the following sections:

```markdown
# Knowledge Plugin ‚Äî Roadmap

## v1.0.0 (Current Release)
- 16 skills for knowledge capture, recall, sync, and management
- MCP server (7 tools + 2 resources) for cross-platform use
- Multi-KG support with per-category git strategies
- Git metadata tracking in lesson/ADR frontmatter
- ~30 generalized examples + 10 documentation files
- Platform-agnostic core for non-Claude users

## Future Considerations

### Skill Aliases / Short Commands
- Allow `/knowledge:cl` as alias for `/knowledge:capture-lesson`
- Configurable aliases in kg-config.json
- Priority: Low (typing speed is minor compared to LLM response time)

### Per-Project Config Overrides
- Allow `.claude/kg-local.json` at project root to override global config
- Use case: team-shared KG settings committed to repo
- Merge strategy: project-local overrides global defaults

### Backup Before Destructive Operations
- `/knowledge:switch` and `/knowledge:init` should snapshot current state
- Auto-backup before category deletion or KG removal
- Lightweight: just `cp -r` to timestamped directory

### Large KG Performance
- Current search is full-text file walk ‚Äî works for <500 files
- Future: Index-based search (SQLite FTS5 or similar)
- Trigger: When `kg_search` response time exceeds 2 seconds

### Archival / Superseding Entries
- Mark KG entries as "superseded by [newer entry]"
- Archive old lessons without deleting (move to `archive/` subdirectory)
- `/knowledge:archive` skill for managing lifecycle

### Config Schema Migration
- v1.0 ‚Üí v1.1 config changes need graceful migration
- Add `"version"` field to kg-config.json (already present)
- MCP `kg_config_init` should check version and migrate if needed

### Cross-Repo Knowledge Graphs
- Share KG entries across multiple repos via global topic-based KGs
- MEMORY.md can reference cross-repo patterns
- Document the pattern in PLATFORM-ADAPTATION.md

### Plugin Marketplace Integration
- Submit to official Claude Code plugin directory
- Auto-update mechanism when new versions are released

### Additional MCP Tools
- `kg_git_metadata` ‚Äî Capture branch, commit, author, PR, issue
- `kg_link_issue` ‚Äî Update YAML frontmatter + post GitHub comment
- `kg_extract_chat` ‚Äî Run Python extraction scripts
```

#### Phase 1 Exit Criteria
- [ ] `claude --plugin-dir ./knowledge-graph-plugin` loads without errors
- [ ] All 8 ported skills appear in skill menu
- [ ] `/knowledge:capture-lesson` creates a lesson file
- [ ] `/knowledge:recall` searches across docs
- [ ] `/knowledge:extract-chat` runs Python scripts successfully
- [ ] SessionStart hook fires
- [ ] No project-specific references in ported skills (spot check)
- [ ] ROADMAP.md exists with future considerations

---

### Phase 2: New Skills (Session 2 ‚Äî Claude Code)
**Goal:** Write 8 new skills that don't have existing source to copy from.
**Deliverable:** All 16 skills functional in the plugin.
**Runs in parallel with:** Phase 3 (Antigravity) and optionally Phase 4.

#### 2.1: Write 8 NEW skills from scratch

| Skill | File | Complexity |
|-------|------|-----------|
| `/knowledge:init` | `skills/init/SKILL.md` | High ‚Äî wizard with 5 prompts, creates dirs + config |
| `/knowledge:list` | `skills/list/SKILL.md` | Low ‚Äî read config, format output |
| `/knowledge:switch` | `skills/switch/SKILL.md` | Low ‚Äî update active field in config |
| `/knowledge:add-category` | `skills/add-category/SKILL.md` | Medium ‚Äî create dirs, update config |
| `/knowledge:configure-sanitization` | `skills/configure-sanitization/SKILL.md` | Medium ‚Äî wizard, install hook |
| `/knowledge:check-sensitive` | `skills/check-sensitive/SKILL.md` | Medium ‚Äî scan files with regex patterns |
| `/knowledge:link-issue` | `skills/link-issue/SKILL.md` | Medium ‚Äî update frontmatter + GitHub comment |
| `/knowledge:status` | `skills/status/SKILL.md` | Low ‚Äî read config + count files + show quick reference |

#### 2.2: Smoke test new skills
Quick verification that each skill loads and basic flow works:
- [ ] `/knowledge:init` ‚Äî wizard prompts appear, creates dirs
- [ ] `/knowledge:list` ‚Äî displays configured KGs
- [ ] `/knowledge:switch` ‚Äî changes active KG
- [ ] `/knowledge:add-category` ‚Äî adds category
- [ ] `/knowledge:configure-sanitization` ‚Äî wizard runs
- [ ] `/knowledge:check-sensitive` ‚Äî scans and reports
- [ ] `/knowledge:link-issue` ‚Äî updates frontmatter
- [ ] `/knowledge:status` ‚Äî shows active KG info and quick reference

#### Phase 2 Exit Criteria
- [ ] All 16 skills appear in `/knowledge:` menu
- [ ] Each new skill completes its basic workflow without errors
- [ ] Config CRUD works: init ‚Üí list ‚Üí switch ‚Üí add-category
- [ ] `/knowledge:status` shows correct stats and warnings for stale/missing config

---

### Phase 3: Examples + Documentation (Session 2 ‚Äî Opus in Antigravity)
**Goal:** Generalize ~30 example files + write all 10 documentation files.
**Deliverable:** Complete example library and docs, ready to drop into plugin directory.
**Runs in parallel with:** Phase 2 (Claude Code) and optionally Phase 4.

**Why Antigravity:** This is pure markdown writing ‚Äî read existing files, generalize content, write new docs. No file system operations or code execution needed. Provide the Antigravity agent with this plan + the source files to generalize.

#### 3.1: Copy and generalize examples (~30 files)
**Source:** Existing KG entries, lessons, ADRs from `docs/`

| Source | Target | Generalization Level |
|--------|--------|---------------------|
| `docs/knowledge/patterns.md` (12 entries) | `core/examples/knowledge/sample-patterns.md` | Medium ‚Äî replace project refs |
| `docs/knowledge/concepts.md` (6 entries) | `core/examples/knowledge/sample-concepts.md` | Medium |
| `docs/knowledge/gotchas.md` (6 entries) | `core/examples/knowledge/sample-gotchas.md` | Medium |
| `docs/lessons-learned/architecture/*.md` (2) | `core/examples/lessons-learned/architecture/` | Medium-High |
| `docs/lessons-learned/process/*.md` (4) | `core/examples/lessons-learned/process/` | Medium |
| `docs/lessons-learned/patterns/*.md` (1) | `core/examples/lessons-learned/patterns/` | Low |
| `docs/decisions/ADR-001.md` | `core/examples/decisions/ADR-001-example.md` | Low |
| `docs/decisions/ADR-011.md` | `core/examples/decisions/ADR-002-example.md` | None |
| `docs/issues/v9.3.x-enforcement-saga/` | `core/examples/meta-issue/example-performance-saga/` | High |

**For each copy:**
1. Add `<!-- THIS IS AN EXAMPLE ‚Äî Replace with your project's patterns -->` header
2. Find/replace: `resume optimization` ‚Üí `output optimization`, `enforcement` ‚Üí `compliance`, `v9.3.x` ‚Üí `v2.x`
3. Replace specific names with roles: "John Smith" ‚Üí "Backend Developer"
4. Replace project-specific skill names: `/gov-git-branch` ‚Üí `/governance:validate-branch`
5. Verify no broken internal cross-references

#### 3.2: Write all documentation (10 files)

**Claude Code Documentation:**
1. `docs/SETUP.md` ‚Äî Post-install instructions (replaces setup-project.sh entirely)
   - **Include:** Team workflow guidance section (multi-developer KG collaboration patterns, shared vs private categories, merge conflict strategies for KG files)
2. Root `README.md` ‚Äî Overview, installation, quick start, portability note, MCP server setup
   - **Include:** Quick Reference card (16 skills with 1-line descriptions in a scannable table)
   - **Include:** Prerequisites section documenting **Node.js 18+** requirement (for MCP server)
   - **Include:** Graceful degradation table showing what works without each optional dependency:

     | Missing Dependency | What Still Works | What Degrades |
     |---|---|---|
     | `gh` CLI | All local skills | No GitHub issue linking, no PR integration |
     | Node.js | All skills | No MCP server (non-Claude users affected) |
     | Python 3 | All skills except extract-chat | No chat extraction |
     | Git | KG creation, recall, sync | No metadata capture, no hook-based features |

**Core/Platform-Agnostic Documentation:**
3. `core/README.md` ‚Äî How to use without Claude Code (manual workflows + MCP server option)
4. `core/docs/ARCHITECTURE.md` ‚Äî How the KG system works (conceptual)
5. `core/docs/PATTERNS-GUIDE.md` ‚Äî Writing good KG entries + abstraction best practices + privacy
6. `core/docs/WORKFLOWS.md` ‚Äî Manual workflows for non-Claude users
7. `core/docs/META-ISSUE-GUIDE.md` ‚Äî When/how to use meta-issue tracking
8. `core/docs/PLATFORM-ADAPTATION.md` ‚Äî Adapt for Continue.dev, Cursor, Aider, local LLMs (include MCP setup)
9. `core/docs/SANITIZATION-CHECKLIST.md` ‚Äî Privacy checklist before public sharing

**Example Hooks:**
10. `core/examples-hooks/pre-commit-sanitization.sh` ‚Äî Optional pre-commit hook

#### 3.3: Handoff to Claude Code
Output all files as markdown content. In the Claude Code session, copy into the plugin directory structure.

#### Phase 3 Exit Criteria
- [ ] All ~30 example files have `<!-- THIS IS AN EXAMPLE -->` headers
- [ ] All 10 documentation files written and internally consistent
- [ ] No project-specific references in examples (spot check 5 files)
- [ ] Terminology generalization applied consistently
- [ ] Files copied into plugin directory and committed

---

### Phase 4: MCP Server (Session 2 or 3 ‚Äî Claude Code)
**Goal:** Build MCP server as the data layer for deterministic operations.
**Deliverable:** Working MCP server that skills can call and non-Claude users can use standalone.
**Runs in parallel with:** Phase 3 (Antigravity). Can also overlap with Phase 2 in the same Claude Code session.

#### 4.1: Decide language and scaffold

**Recommendation: TypeScript** ‚Äî most common MCP language, better type safety, wider MCP ecosystem support. If Python preferred (reuses extraction scripts), use Python MCP SDK instead.

```bash
cd knowledge-graph-plugin/mcp-server
npm init -y
npm install @modelcontextprotocol/sdk zod
```

#### 4.2: Implement MCP tools (7 tools)

| MCP Tool | Maps to Skill | What it does |
|----------|---------------|-------------|
| `kg_config_init` | init | Create KG dir structure + write config entry |
| `kg_config_list` | list | Read and return all KGs from config |
| `kg_config_switch` | switch | Update active KG in config |
| `kg_config_add_category` | add-category | Add category dir + update config |
| `kg_search` | recall | Full-text search across KG files, return ranked results |
| `kg_scaffold` | capture-lesson, meta-issue | Create file from template with variable substitution |
| `kg_check_sensitive` | check-sensitive | Scan files against regex patterns, return report |

**Optional tools (if time permits):**

| MCP Tool | Maps to Skill | What it does |
|----------|---------------|-------------|
| `kg_git_metadata` | capture-lesson | Capture branch, commit, author, PR, issue |
| `kg_link_issue` | link-issue | Update YAML frontmatter + post GitHub comment |
| `kg_extract_chat` | extract-chat | Run Python extraction, return results |

#### 4.3: Implement MCP resources (2 resources)

| Resource | What it exposes |
|----------|----------------|
| `kg://config` | Current kg-config.json contents |
| `kg://templates/{name}` | Template files from `core/templates/` |

#### 4.4: Wire MCP server into plugin

Update `.claude-plugin/plugin.json` to reference MCP server:
```json
{
  "mcp_servers": {
    "knowledge": {
      "command": "node",
      "args": ["${CLAUDE_PLUGIN_ROOT}/mcp-server/dist/index.js"]
    }
  }
}
```

Update skills to call MCP tools where appropriate (skills become thinner orchestration):
- `capture-lesson` calls `kg_scaffold` + `kg_git_metadata` then does LLM reasoning
- `recall` calls `kg_search` then formats output
- `check-sensitive` calls `kg_check_sensitive` then presents findings
- `init` calls `kg_config_init` then does wizard prompts

#### 4.5: MCP build automation
Add a `postinstall` script to `mcp-server/package.json` so the MCP server builds automatically when dependencies are installed:
```json
{
  "scripts": {
    "build": "tsc",
    "postinstall": "npm run build"
  }
}
```
Also add a `prepare-mcp.sh` script at `scripts/prepare-mcp.sh` that checks for Node.js, runs `npm install` in `mcp-server/`, and verifies the build succeeded. The `/knowledge:init` wizard should call this if MCP features are desired.

#### 4.6: Test MCP server standalone
```bash
cd mcp-server && npm run build
# Test with MCP inspector or direct invocation
npx @modelcontextprotocol/inspector node dist/index.js
```

#### Phase 4 Exit Criteria
- [ ] MCP server builds without errors
- [ ] All 7 core tools return correct results
- [ ] Resources serve config and templates
- [ ] Plugin manifest references MCP server
- [ ] MCP inspector shows all tools and resources
- [ ] Skills that call MCP tools still work end-to-end

---

### Phase 5: Sanitization, Testing & Publishing (Final Session ‚Äî Claude Code)
**Goal:** Full sanitization pass, end-to-end testing of everything, extract to standalone repo, publish.
**Deliverable:** Published plugin on GitHub, installable via marketplace.
**Depends on:** Phases 1-4 all complete.

#### 5.1: Create and run sanitization validator
Create `scripts/validate-plugin.sh` that scans ALL plugin files for:
- Project-specific terms: `resume`, `enforcement`, `v9.3`, `v9.4`, `Shadow Sync` (as feature name)
- Personal info: names, email addresses, company-specific references
- Hardcoded paths: `/Users/mkaplan`, optimize-my-resume repo paths
- GitHub issue numbers from original project (#1-#103)
- Output: List of violations with `file:line` references
- Exit code 1 if any violations, 0 if clean

**Run until zero violations.** Fix all findings, re-run.

#### 5.2: Validate plugin structure
Verify plugin loads correctly:
```bash
claude --plugin-dir ./knowledge-graph-plugin
```
Check that `.claude-plugin/plugin.json` is valid, all skill directories have `SKILL.md`, hooks resolve, MCP server starts.

**Note (Opus #3):** `claude plugin validate` may not be a real CLI command. Use manual verification: load plugin, list skills, verify hook fires, verify MCP tools appear. If the validate command exists at time of implementation, use it as well.

#### 5.3: Validate `core/` accessibility
**Critical (Opus #1):** Test whether `${CLAUDE_PLUGIN_ROOT}/core/templates/` is accessible after plugin installation. If plugin caching flattens the directory:
- **Mitigation A:** Skills/MCP tools that reference `core/` paths inline the template content instead
- **Mitigation B:** Move templates to `templates/` at plugin root (parallel to `skills/`)
- Document which approach was needed in CHANGELOG.md

#### 5.4: Test all 16 skills + MCP server end-to-end
Test locally with `claude --plugin-dir ./knowledge-graph-plugin`:

**Phase 1 skills (re-verify):**
- [ ] `/knowledge:capture-lesson` ‚Äî creates lesson with git metadata frontmatter
- [ ] `/knowledge:recall` ‚Äî searches across all KG systems
- [ ] `/knowledge:update-graph` ‚Äî extracts entries preserving metadata
- [ ] `/knowledge:sync-all` ‚Äî runs full pipeline
- [ ] `/knowledge:update-issue-plan` ‚Äî syncs to issue (GitHub optional)
- [ ] `/knowledge:session-summary` ‚Äî generates session doc
- [ ] `/knowledge:extract-chat` ‚Äî runs Python scripts, output goes to active KG
- [ ] `/knowledge:meta-issue` ‚Äî scaffolds directory structure

**Phase 2 skills (re-verify):**
- [ ] `/knowledge:init` ‚Äî wizard creates KG, writes to kg-config.json
- [ ] `/knowledge:list` ‚Äî displays all configured KGs
- [ ] `/knowledge:switch` ‚Äî changes active KG, subsequent skills use it
- [ ] `/knowledge:add-category` ‚Äî adds category to existing KG
- [ ] `/knowledge:configure-sanitization` ‚Äî sets up pre-commit hook
- [ ] `/knowledge:check-sensitive` ‚Äî scans and reports sensitive data
- [ ] `/knowledge:link-issue` ‚Äî links lesson to GitHub issue
- [ ] `/knowledge:status` ‚Äî shows active KG info, stats, and quick reference

**Phase 4 MCP server:**
- [ ] MCP tools appear in tool list
- [ ] `kg_config_init` creates KG correctly
- [ ] `kg_search` returns relevant results
- [ ] `kg_scaffold` creates files from templates
- [ ] `kg_check_sensitive` reports findings
- [ ] Skills that delegate to MCP tools work end-to-end

**Integration tests:**
- [ ] Init ‚Üí capture-lesson ‚Üí update-graph ‚Üí recall (full workflow)
- [ ] Init ‚Üí switch ‚Üí capture-lesson (multi-KG workflow)
- [ ] GitHub-optional mode (no remote configured)
- [ ] Hook fires on SessionStart
- [ ] Non-Claude user path: MCP server standalone with MCP inspector

#### 5.5: Fix bugs discovered during testing
Fix any issues, re-run sanitization validator, re-test affected skills and MCP tools.

#### 5.6: Extract to separate repository
```bash
mkdir ~/Documents/GitHub/knowledge-graph-plugin
cp -r knowledge-graph-plugin/* ~/Documents/GitHub/knowledge-graph-plugin/
cp -r knowledge-graph-plugin/.claude-plugin ~/Documents/GitHub/knowledge-graph-plugin/
cd ~/Documents/GitHub/knowledge-graph-plugin
git init
git add -A
git commit -m "feat: initial release of knowledge plugin v1.0.0

16 skills, MCP server (7 tools + 2 resources), multi-KG support,
git metadata tracking, ~30 generalized examples.
Platform-agnostic core in core/ for non-Claude users.
MCP server usable standalone by Cursor/Continue/Cline users.
"
```

#### 5.7: Publish to GitHub
1. Create GitHub repo: `technomensch/knowledge-graph-plugin`
2. Push to remote
3. Test installation: `claude --plugin-dir` from the separate repo
4. Verify skills + MCP server work when installed from external path
5. Optional: Create marketplace.json, submit to official directory

#### Phase 5 Exit Criteria
- [ ] `validate-plugin.sh` passes with ZERO violations
- [ ] All 16 skills tested and working
- [ ] MCP server tested (7 tools + 2 resources)
- [ ] `core/` paths accessible (or mitigated per 5.3)
- [ ] Plugin works from standalone repo (not just embedded)
- [ ] Published to GitHub
- [ ] README.md has installation instructions for both plugin and MCP server

---

## Build Locally First: Benefits Summary

**Token Savings:**
- Copy 8 existing skills (~3000 lines) instead of generating from scratch: **~500K tokens saved**
- Copy 5 Python scripts (~800 lines) instead of rewriting: **~100K tokens saved**
- Copy 30 example files (~5000 lines) via Antigravity parallel session: **~800K tokens saved**
- **Total savings: ~1.4M tokens** (equivalent to 7 full Claude sessions)

**Parallelization Savings:**
- Phases 2 + 3 run simultaneously ‚Üí **~1 calendar session saved**
- Phase 4 can overlap with Phase 2 in same Claude Code session ‚Üí potential **additional session saved**
- Worst case: 4 sessions sequential. Best case: 3 sessions (Phase 2+4 in one, Phase 3 parallel)

**Quality Benefits:**
- ‚úÖ Preserve battle-tested code (no rewrite bugs)
- ‚úÖ Consistent with existing patterns
- ‚úÖ Test in real environment before extraction
- ‚úÖ Iterative refinement (fix issues locally before publishing)

**Workflow:**
1. ‚úÖ Build in separate repo `/Users/mkaplan/Documents/GitHub/knowledge-graph-plugin/`
2. Test with `claude --plugin-dir .` (from plugin directory)
3. Use in real work to validate
4. Fix bugs discovered during use
5. Extract to separate repo once stable
6. Publish to GitHub

**Gitignore note:** Add `knowledge-graph-plugin/` to `.gitignore` during development to keep it separate from project commits.

---

## Things You Might Have Forgotten

### 1. Plugin Versioning Strategy
The plugin needs its own versioning separate from the resume project. Start at `1.0.0`. The plugin's CHANGELOG.md tracks plugin changes, not project changes.

### 2. Python Dependency Management
The chat extraction scripts use only stdlib, but should include a check. Add a `requirements.txt` (even if empty) and have `/knowledge:init` verify Python 3 is available when chat extraction is desired.

### 3. MEMORY.md Location Discovery ‚ö†Ô∏è OPEN
MEMORY.md lives at `~/.claude/projects/[project-hash]/memory/MEMORY.md`. The path uses a hash derived from the project path, NOT a simple sed transform.

**Discovery strategy (implement in `/knowledge:init` and MCP `kg_config_init`):**
1. Search `~/.claude/projects/*/memory/MEMORY.md` for files that exist
2. Read each MEMORY.md, check if it references the current project (by repo name or path)
3. If found ‚Üí use that path. If not found ‚Üí prompt user to provide or create new.
4. Store discovered MEMORY.md path in `kg-config.json` per-graph entry.

**Fallback:** If discovery fails, instruct user: "Run `find ~/.claude/projects -name MEMORY.md` and provide the path for this project."

**Phase assignment:** Phase 2 (`/knowledge:init` skill) + Phase 4 (MCP `kg_config_init` tool)

### 4. Existing Project Migration Guide
If someone already has `docs/lessons-learned/` or `docs/knowledge/`, they need a migration path. Add a section to SETUP.md: "Integrating with Existing Documentation."

### 5. Cross-Platform Compatibility
The shell scripts (check-memory.sh, prepare-mcp.sh) need to work on macOS and Linux. Avoid macOS-specific `sed -i ''` syntax ‚Äî use portable alternatives.

### 6. Plugin Updates and Data Preservation
When users update the plugin, their project data (lessons, KG entries) must NOT be overwritten. The plugin only writes to its own directory; project files are copied during setup, not symlinked.

### 7. Offline/No-GitHub Mode
Not all projects use GitHub. The `sync-all` and `update-issue-plan` skills should gracefully skip GitHub operations when no remote is configured.

### 8. Template Customization ‚ö†Ô∏è OPEN
Users may want to customize templates (add fields, change categories). Document how to override plugin templates with project-local versions.

**Strategy (implement in Phase 3 docs + Phase 4 MCP):**
1. **Priority order:** Project-local template > Plugin template. If `docs/templates/lesson-template.md` exists in user's project, use it instead of `core/templates/lessons-learned/lesson-template.md`.
2. **MCP `kg_scaffold` tool:** Check active KG path for local templates first, fall back to plugin templates.
3. **Documentation:** Add "Customizing Templates" section to `docs/SETUP.md` and `core/docs/WORKFLOWS.md`.
4. **Example:** Show how to add a custom field (e.g., `severity:` to lesson frontmatter).

**Phase assignment:** Phase 3 (documentation) + Phase 4 (MCP scaffold tool implements override logic)

### 9. Multiple Knowledge Graphs
Some users may have multiple related repos. Consider documenting how MEMORY.md can reference cross-repo knowledge (not in v1.0, but document the pattern).

### 10. Plugin Testing Framework
Before publishing, create a test project that installs the plugin fresh and runs through the full workflow: install ‚Üí setup ‚Üí capture lesson ‚Üí update KG ‚Üí recall ‚Üí sync-all.

### 11. License File
Include MIT license. The chat extraction scripts and skill content need clear licensing.

### 12. Marketplace README
The marketplace repo needs its own README explaining what the plugin does, with screenshots/examples of the skills in action.

### 13. Core Portability Documentation
The `core/README.md` must explain how to use the knowledge graph system WITHOUT Claude Code:
- Manual workflow: Create lesson ‚Üí Extract to KG ‚Üí Link to MEMORY.md
- How to copy templates to your project
- How to run Python scripts standalone
- Reference to `core/docs/WORKFLOWS.md` for step-by-step manual processes
This documentation allows local LLM users, Cursor users, Continue.dev users, etc. to benefit from the core system.

### 14. Platform Adaptation Guide
Document (in `core/README.md` or root `README.md`) how developers can adapt the core for other platforms:
- **Continue.dev**: Create commands that use core templates
- **Cursor**: Create rules that reference core patterns
- **Aider**: Create bash scripts that populate core structure
- **Local LLMs**: Use core templates directly with system prompts
Include example snippets for each platform showing how to trigger lesson capture or KG updates.

### 15. Privacy & Sanitization Guidelines (CRITICAL)
**Problem**: Users may inadvertently include sensitive information in KG entries or lessons that get committed to public repos.

**Solutions**:
1. **Documentation warning** (in SETUP.md, README.md, PATTERNS-GUIDE.md):
   - "‚ö†Ô∏è WARNING: Never commit personal information, credentials, API keys, internal system details, or confidential project data to your knowledge graph."
   - "Before sharing your knowledge graph publicly, review all entries for sensitive information."

2. **Sanitization checklist** (in `core/docs/SANITIZATION-CHECKLIST.md`):
   - [ ] No personal names (replace with roles: "Backend Developer", "Team Lead")
   - [ ] No email addresses or usernames
   - [ ] No company-specific internal tools or system names
   - [ ] No API endpoints, server names, or infrastructure details
   - [ ] No code snippets containing credentials or secrets
   - [ ] No customer/client names or project codenames
   - [ ] No API keys or passwords
   - [ ] Patterns and lessons are generalized (not project-specific)

3. **Pre-commit hook suggestion** (optional, documented in SETUP.md):
   - Users can add a `.git/hooks/pre-commit` that scans `docs/knowledge/`, `docs/lessons-learned/` for common sensitive patterns (emails, API keys)
   - Provide example hook script in `core/examples/pre-commit-sanitization.sh`

4. **Best practices guide** (in `core/docs/PATTERNS-GUIDE.md`):
   - **Write abstractly**: "When debugging authentication..." not "When debugging Auth0 login for Acme Corp..."
   - **Use placeholders**: `api.example.com` not `api.mycompany.com`
   - **Generalize context**: "Performance issues in microservices" not "Latency in OrderService hitting MongoDB"
   - **Focus on patterns, not specifics**: Teach the lesson, not the project history

### 16. Examples vs. Default Project Setup (CRITICAL)
**Key distinction**: Plugin examples are for reference ONLY, not for copying into projects.

**Setup script behavior**:
- `/knowledge:init` wizard creates directories from `core/templates/`
- Does NOT copy `core/examples/` to project
- Examples remain in plugin directory for reference: "See ${CLAUDE_PLUGIN_ROOT}/core/examples/"
- Users explicitly opt-in to copy examples: `cp -r ${CLAUDE_PLUGIN_ROOT}/core/examples/knowledge/* docs/knowledge/` (documented but not automatic)

**Documentation emphasis**:
- README.md: "This plugin provides a framework for knowledge management. The examples are illustrative ‚Äî customize them for your project."
- SETUP.md: "Examples in the plugin are not copied by default. They demonstrate usage patterns but should be adapted to your context."
- PATTERNS-GUIDE.md: "Write entries that reflect YOUR project's unique challenges and insights. The plugin structure is reusable; the content is not."

### 17. Terminology Generalization for Examples
Replace all project-specific terms in example files:
- `resume optimization` ‚Üí `output quality optimization` or `document optimization`
- `enforcement saga` ‚Üí `compliance saga` or `quality assurance saga`
- `Shadow Sync Protocol` ‚Üí `Multi-Tier Synchronization Pattern` (when used as example)
- `v9.3.x` ‚Üí `v2.x` or `phase 2`
- `PROJECT-INSTRUCTIONS.md` ‚Üí `PROJECT-CONFIG.md` (generic)
- Specific skill names (`/gov-git-branch`) ‚Üí generic (`/governance:validate-branch`) in examples

### 18. Multi-KG Architecture & Configuration File (CRITICAL)
**Problem**: The original plan assumed one KG per project, but users need flexibility:
- Multiple KGs for different projects
- Topic-based KGs (not project-bound)
- Claude Cowork usage (no project directory)
- Different git strategies per-KG (some committed, some private)

**Solution**: `~/.claude/kg-config.json` tracks all KGs
- `/knowledge:init` creates new KG entry (wizard-based)
- `/knowledge:list` shows all configured KGs
- `/knowledge:switch` changes active KG
- All skills operate on "active" KG from config

**Configuration persistence**:
- Config file persists across sessions
- Each KG can have custom categories
- Per-category git strategies (selective commit/ignore)
- Users can add categories later via `/knowledge:add-category`

**First-time user experience**:
1. Install plugin
2. Run `/knowledge:init` (NOT automatic setup)
3. Answer wizard prompts (location, categories, git strategy)
4. KG is created, set as active, config is saved
5. Subsequent skills use this active KG

**Claude Cowork use case**:
- User working in Claude Cowork (no project directory)
- Run `/knowledge:init`
- Select "Claude Cowork" type
- KG stored at `~/.claude/cowork-knowledge/[topic]/`
- All gitignored by default (no repo to commit to)

### 19. User Sanitization != Plugin Sanitization
**Two separate concerns**:
1. **Plugin sanitization** (Step 10): Ensure the PLUGIN itself has no project-specific terms before publishing
2. **User sanitization**: Help USERS clean THEIR knowledge graphs before public sharing

**User-side features**:
- `/knowledge:configure-sanitization` - wizard to set up pre-commit hooks
- `/knowledge:check-sensitive` - scan active KG for sensitive data
- `core/docs/SANITIZATION-CHECKLIST.md` - guidance for users, not just plugin authors
- `core/examples-hooks/pre-commit-sanitization.sh` - example hook users can install

**Documentation must clarify**:
- Plugin is sanitized (safe to install)
- YOUR knowledge graph may contain sensitive data
- Run `/knowledge:check-sensitive` before pushing to GitHub
- Use `/knowledge:configure-sanitization` to set up automated checks

---

## Verification

### Functional Tests
- [ ] `claude plugin validate .` passes
- [ ] `claude --plugin-dir ./knowledge-graph-plugin` loads without errors
- [ ] All 16 skills appear in `/knowledge:` menu
- [ ] `/knowledge:capture-lesson` creates lesson file in correct directory
- [ ] `/knowledge:update-graph` extracts entry and adds to KG
- [ ] `/knowledge:recall "pattern"` finds entries across all systems
- [ ] `/knowledge:sync-all` runs full pipeline with single confirmation
- [ ] `/knowledge:session-summary` generates session doc
- [ ] `/knowledge:extract-chat` runs Python scripts successfully
- [ ] `/knowledge:meta-issue "test"` scaffolds directory structure
- [ ] SessionStart hook fires and checks MEMORY.md
- [ ] knowledge-reviewer subagent available

### Integration Tests
- [ ] Fresh project: `/knowledge:init` creates all directories
- [ ] Existing project: `/knowledge:init` skips existing dirs
- [ ] Setup does NOT copy examples by default (templates only)
- [ ] MEMORY.md template works in new project
- [ ] Examples are clearly marked as examples (not real data)
- [ ] All paths use `${CLAUDE_PLUGIN_ROOT}` or relative paths
- [ ] Plugin works on macOS and Linux
- [ ] GitHub-optional mode works (no remote configured)

### Sanitization Tests (CRITICAL)
- [ ] `scripts/validate-plugin.sh` exists and is executable
- [ ] Validation script scans all files (skills, examples, docs, templates)
- [ ] Script detects project-specific terms: `resume`, `enforcement`, `v9.3`, `v9.4`
- [ ] Script detects hardcoded paths: `/Users/mkaplan`, specific repo paths
- [ ] Script detects GitHub issue numbers from original project (#1-#103)
- [ ] Script exits with code 1 if violations found, 0 if clean
- [ ] Run validation script: ZERO violations found
- [ ] All examples use generic terminology (no "resume optimization", use "output optimization")
- [ ] All examples use generic version numbers (v2.x, not v9.3.x)
- [ ] No personal names or email addresses in any file
- [ ] `core/docs/SANITIZATION-CHECKLIST.md` exists and is comprehensive
- [ ] `core/docs/PATTERNS-GUIDE.md` includes abstraction best practices
- [ ] `core/examples-hooks/pre-commit-sanitization.sh` exists
- [ ] All documentation includes privacy warnings about sensitive data

### Publishing Tests
- [ ] Marketplace installs from GitHub: `/plugin marketplace add technomensch/knowledge-graph-plugin`
- [ ] Plugin installs: `/plugin install knowledge@technomensch-tools`
- [ ] Skills work after marketplace install
- [ ] Plugin update doesn't overwrite project data
- [ ] Setup script copies templates but NOT examples (verify docs/ has templates, not sample-patterns.md)
- [ ] Setup script prints message about examples location and privacy warning

---

## Scope Exclusions

- **Shadow Sync Protocol**: NOT replicated as a feature. Included only as a generalized example lesson-learned (`Example_Three_Tier_Sync.md`)
- **Git governance hooks** (`validate-commit.sh`, `validate-branch.sh`): Project-specific, not included
- **Resume/job optimization skills** (`proj-*`): Not included
- **Plan execution enforcement** (`gov-execute-plan`): Not included
- **Branch hierarchy enforcement**: Not included

---

## Files to Create (New Plugin Repo)

| Category | Count | Key Files | Phase |
|----------|-------|-----------|-------|
| Plugin config | 2 | `plugin.json`, `marketplace.json` | 1 |
| Skills (SKILL.md) | 16 | 8 ported + 8 new (see skill sections above) | 1 + 2 |
| MCP Server | ~8 | `index.ts`, 7 tool files, `package.json`, `tsconfig.json` | 4 |
| MCP Resources | 2 | `config.ts`, `templates.ts` | 4 |
| Agents | 1 | knowledge-reviewer.md | 1 |
| Hooks | 2 | hooks.json, check-memory.sh | 1 |
| Scripts ‚Äî Root | 2 | check-memory.sh, validate-plugin.sh | 1 + 5 |
| Scripts ‚Äî Core | 5 | 5 Python chat extractors (in core/scripts/) | 1 |
| Config | 1 | config/kg-config-template.json | 1 |
| Templates | 14 | KG (7), lessons (2), decisions (2), meta-issue (5+), sessions (1), MEMORY (1) | 1 |
| Examples ‚Äî KG | 3 | sample-patterns.md (12), sample-concepts.md (6), sample-gotchas.md (6) | 3 |
| Examples ‚Äî Lessons | 7 | architecture/ (2), process/ (4), patterns/ (1) | 3 |
| Examples ‚Äî ADRs | 2 | ADR-001-example.md, ADR-002-example.md | 3 |
| Examples ‚Äî Meta-Issue | 4+ | example-performance-saga/ (README, description, 2 attempts) | 3 |
| Examples ‚Äî Hooks | 1 | core/examples-hooks/pre-commit-sanitization.sh | 3 |
| Documentation ‚Äî Claude | 2 | docs/SETUP.md, root README.md | 3 |
| Documentation ‚Äî Core | 7 | core/README.md + core/docs/{ARCHITECTURE, PATTERNS-GUIDE, WORKFLOWS, META-ISSUE-GUIDE, PLATFORM-ADAPTATION, SANITIZATION-CHECKLIST}.md | 3 |
| Other | 3 | LICENSE, CHANGELOG.md, ROADMAP.md | 1 |
| **Total** | **~80+ files** | 16 skills + 7 MCP tools + 2 resources + ~30 examples + 10 docs |

---

## Source File Mapping (What Comes From Where)

| Plugin File | Source in optimize-my-resume | Generalization Level |
|-------------|----------------------------|---------------------|
| `skills/capture-lesson/SKILL.md` | `.agent/workflows/know-capture-lesson.md` | Medium (remove project refs) |
| `skills/recall/SKILL.md` | `.agent/workflows/know-recall.md` | Low (mostly generic already) |
| `skills/update-graph/SKILL.md` | `.agent/workflows/know-update-graph.md` | Medium (remove project refs) |
| `skills/sync-all/SKILL.md` | `.agent/workflows/know-sync-all.md` | Low (mostly generic) |
| `skills/update-issue-plan/SKILL.md` | `.agent/workflows/know-update-issue-plan.md` | Medium (make GitHub optional) |
| `skills/session-summary/SKILL.md` | `.agent/workflows/doc-session-summary.md` | Medium (remove project refs) |
| `skills/extract-chat/SKILL.md` | `.agent/workflows/proj-extract-chat.md` | Low (already generic) |
| `skills/meta-issue/SKILL.md` | NEW (based on ADR-008 pattern) | N/A (new skill) |
| `scripts/*.py` | `chat-history/scripts/*.py` | Low (make paths configurable) |
| `templates/knowledge/*` | `docs/knowledge/*.md` | High (strip all project content) |
| `templates/lessons-learned/*` | `docs/lessons-learned/` structure | High (templates only) |
| `templates/decisions/*` | `docs/decisions/` structure | High (templates only) |
| `templates/meta-issue/*` | ADR-008 templates | Medium (generalize examples) |
| `examples/knowledge/sample-patterns.md` | `docs/knowledge/patterns.md` (12 entries) | Medium-High (generalize project refs) |
| `examples/knowledge/sample-concepts.md` | `docs/knowledge/concepts.md` (6 entries) | Medium (generalize project refs) |
| `examples/knowledge/sample-gotchas.md` | `docs/knowledge/gotchas.md` (6 entries) | Medium (generalize project refs) |
| `examples/lessons-learned/architecture/Example_Three_Tier_Sync.md` | Shadow Sync lesson | High (full content replacement) |
| `examples/lessons-learned/architecture/Example_Claude_Code_Skills_Arch.md` | Skills Architecture lesson | Low (already generic) |
| `examples/lessons-learned/process/Example_LLM_Constraint_Patterns.md` | Effective LLM Constraints lesson | Low (already generic) |
| `examples/lessons-learned/process/Example_SessionStart_Automation.md` | SessionStart Automation lesson | Low (rename skills) |
| `examples/lessons-learned/process/Example_Identifier_Decoupling.md` | Identifier Decoupling lesson | Low (already generic) |
| `examples/lessons-learned/process/Example_Agentic_Momentum.md` | Agentic Momentum lesson | Medium (generalize resume refs) |
| `examples/lessons-learned/patterns/Example_Memory_System_Foundation.md` | Memory System Phase 1 lesson | Low (mostly generic already) |
| `examples/decisions/ADR-001-example.md` | ADR-001 Dual-Format Documentation | Low (already generic) |
| `examples/decisions/ADR-002-example.md` | ADR-011 KG ‚Üî Memory Sync | None (already domain-agnostic) |
| `examples/meta-issue/example-performance-saga/` | `docs/issues/v9.3.x-enforcement-saga/` | High (full content replacement) |
