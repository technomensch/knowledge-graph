# v0.0.4-alpha Plan: MEMORY.md Restore Capability

## Context

**Problem:** v0.0.3-alpha added `/knowledge:archive-memory` to manage MEMORY.md bloat, but there's no way to restore archived entries. Users who archive entries cannot recover them without manual editing.

**Solution:** Implement `/knowledge:restore-memory` command to enable restoring archived entries with search, preview, and selective restoration.

**Previous version:** 0.0.3-alpha
**Branch:** `v0.0.4-alpha`

---

## Architectural Decision: Minimal Scope (Restore Only)

**Decision:** Implement restore command only, defer rules engine and smart summarization to v0.0.5-alpha.

**Rationale:**
- Archive without restore is incomplete UX (users need both capabilities)
- Restore command is well-defined and low-risk
- Allows gathering user feedback on archive/restore workflow before investing in automation
- Rules engine needs real-world MEMORY.md patterns from v0.0.3 usage
- Smart summarization requires LLM integration (adds complexity)

**Deferred to v0.0.5-alpha:**
- MEMORY.md auto-sync rules engine (YAML-based pattern matching)
- Smart summarization (LLM-powered entry consolidation)
- Advanced confidence scoring for rule triggers

**See ADR:** `decisions/ADR-XXX-defer-memory-rules-engine.md`

---

## Implementation Plan

### Phase 1: Core Restore Command

#### File 1: Create `commands/restore-memory.md`

**New command:** `/knowledge:restore-memory`

**Features:**
- Restore by entry title (fuzzy search)
- Restore by entry ID/index from archive
- List all archived entries
- Preview entry before restoring
- Choose target section in MEMORY.md

**Parameters:**
- `query` (optional): Entry title or search query
- `--id` (optional): Archive entry ID/index
- `--list` (optional): List all archived entries
- `--section` (optional): Target section in MEMORY.md
- `--dry-run` (optional): Preview without writing

**Usage examples:**
```bash
/knowledge:restore-memory "Git Pre-Commit Hooks"
/knowledge:restore-memory --list
/knowledge:restore-memory --id=5
/knowledge:restore-memory "Docker" --section="Best Practices"
```

**Workflow:**
1. Read MEMORY-archive.md
2. Parse archived entries (extract titles, dates, content)
3. If --list: display all entries with IDs
4. If query: fuzzy search for matching entries
5. If --id: select entry by ID
6. Preview entry and ask for confirmation
7. Insert entry into MEMORY.md at appropriate location
8. Update archive log (mark as restored)
9. Calculate new token count and show summary
10. Commit both files

**Edge cases:**
- Archive file doesn't exist (error)
- No matching entries (suggest --list)
- Multiple matches (show all, ask user to select)
- MEMORY.md at token limit (warn before restoring)
- Entry already exists in MEMORY.md (warn, ask to proceed)

#### File 2: Update `commands/archive-memory.md`

**Enhancement:** Add restoration tracking to archive log

**Changes:**
- Add "Restored" column to archive log entries
- Track restoration timestamp
- Mark entries as "restored" vs "archived"

**Archive log format (updated):**
```markdown
## Archive Log

**2026-02-16:** Archived 5 entries (~340 tokens freed)
- Git Pre-Commit Hooks (235 days old) [Restored: 2026-02-20]
- Old Docker Pattern (187 days old)
- Deprecated API Approach (156 days old)
```

#### File 3: Create `scripts/fuzzy-search-archive.sh` (helper)

**Purpose:** Fuzzy search helper for archive entries

**Functionality:**
- Read MEMORY-archive.md
- Extract all entry titles
- Fuzzy match against query
- Return ranked results

**Usage:**
```bash
./scripts/fuzzy-search-archive.sh "docker" memory/MEMORY-archive.md
# Output: Ranked list of matches with entry IDs
```

### Phase 2: Integration & Polish

#### File 4: Update `skills/knowledge-graph-usage/SKILL.md`

**Addition:** Document restore command in workflow patterns

**Section:** "After archiving entries" workflow

```markdown
**After archiving entries:**
```
1. /knowledge:archive-memory
2. Review archived entries with --list
3. Restore if needed: /knowledge:restore-memory "Entry Name"
```

#### File 5: Update `README.md`

**Changes:**
- Command count: 17 → 18
- Update "What's New in v0.0.4"
- Add restore-memory to command list

#### File 6: Update `ROADMAP.md`

**Addition:** v0.0.4-alpha section

#### File 7: Update `CHANGELOG.md`

**Addition:** v0.0.4-alpha entry

### Phase 3: ADR Documentation

#### File 8: Create `decisions/ADR-XXX-defer-memory-rules-engine.md`

**Title:** Defer MEMORY.md Auto-Sync Rules Engine to v0.0.5

**Status:** Accepted

**Context:**
- v0.0.3-alpha added archive capability
- v0.0.4-alpha planning considered rules engine + restore
- Rules engine would automate MEMORY.md sync decisions

**Decision:**
- Implement restore command in v0.0.4-alpha
- Defer rules engine to v0.0.5-alpha
- Defer smart summarization to v0.0.5-alpha

**Rationale:**
- Archive without restore is incomplete (users need both)
- Rules engine needs real-world usage patterns from v0.0.3
- Smart summarization requires LLM integration (complex)
- Focused scope maintains release velocity (2-3 days vs 1-2 weeks)
- Allows gathering feedback before investing in automation

**Consequences:**
- Users manually decide what to sync to MEMORY.md (v0.0.4)
- Automation deferred until v0.0.5-alpha
- Simpler, more predictable behavior in v0.0.4

**Alternatives Considered:**
1. **Rules engine + restore** (medium scope)
   - Pros: Automation value, semi-intelligent sync
   - Cons: Needs real-world patterns, adds complexity
2. **Full automation** (all deferred features)
   - Pros: Complete vision, maximum automation
   - Cons: Complex, long timeline, needs LLM integration
3. **Restore only** (minimal scope) ← **SELECTED**
   - Pros: Completes archive feature, focused, quick
   - Cons: No automation yet (deferred value)

---

## Files Summary

**New (3 files):**
1. `commands/restore-memory.md` — Restore archived MEMORY.md entries
2. `scripts/fuzzy-search-archive.sh` — Search helper for archive
3. `decisions/ADR-XXX-defer-memory-rules-engine.md` — Document architectural decision

**Modified (5 files):**
4. `commands/archive-memory.md` — Add restoration tracking
5. `skills/knowledge-graph-usage/SKILL.md` — Document restore workflow
6. `README.md` — Update version, command count (17→18)
7. `ROADMAP.md` — Add v0.0.4-alpha section
8. `CHANGELOG.md` — Add v0.0.4-alpha entry

**Total: 8 files** (3 new, 5 modified)

---

## Verification Plan

### Core Functionality (Implementation Complete - User Testing Required)
- [x] `/knowledge:restore-memory "Entry Name"` restores from archive
- [x] `/knowledge:restore-memory --list` shows all archived entries
- [x] `/knowledge:restore-memory --id=5` restores by ID
- [x] Fuzzy search finds entries with partial matches
- [x] Preview shows entry content before restoring
- [x] Confirmation required before writing
- [x] Token count checked before restoring
- [x] Both MEMORY.md and MEMORY-archive.md updated
- [x] Archive log marks entry as "Restored"
- [x] Commit message includes both files

### Edge Cases (Implementation Complete - User Testing Required)
- [x] No archive file → Error with helpful message
- [x] No matching entries → Suggest --list
- [x] Multiple matches → Show all, ask user to select
- [x] MEMORY.md at token limit → Warn before restoring
- [x] Entry already exists → Warn, ask to proceed
- [x] Dry-run mode works without writing files

### Integration
- [x] Skill documents restore workflow
- [x] Command count updated (17→18)
- [x] README shows restore-memory in command list
- [x] ROADMAP has v0.0.4-alpha section
- [x] CHANGELOG has v0.0.4-alpha entry
- [x] ADR documents deferral decision

### Version Bumps
- [x] `plugin.json` version → `0.0.4-alpha`
- [x] `README.md` version → `0.0.4-alpha`
- [x] `ROADMAP.md` has v0.0.4-alpha entry
- [x] `CHANGELOG.md` has v0.0.4-alpha entry
- [x] `decisions/` has ADR for rules deferral

---

## Timeline

**Estimated:** 2-3 days

**Day 1:**
- Create restore-memory.md command (core workflow)
- Implement fuzzy search helper script
- Handle basic restore cases

**Day 2:**
- Edge case handling (no matches, duplicates, token limits)
- Archive log restoration tracking
- Dry-run mode and previews

**Day 3:**
- ADR documentation
- Integration updates (skill, README, etc.)
- Version bumps and testing

---

## Success Criteria

**v0.0.4-alpha is complete when:**
1. Users can restore archived entries by name or ID
2. Fuzzy search helps find entries with partial queries
3. Preview and confirmation prevents accidental restores
4. Token limits are checked before restoration
5. Archive log tracks which entries were restored
6. Documentation explains restore workflow
7. ADR documents decision to defer rules engine
8. All verification checkboxes marked complete
