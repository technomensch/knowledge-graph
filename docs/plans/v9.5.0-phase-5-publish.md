# v9.5.0 Phase 5: Sanitization, Testing & Publishing

**Session:** 3 or 4 (final) — Claude Code
**Goal:** Full sanitization pass, end-to-end testing of everything, extract to standalone repo, publish.
**Deliverable:** Published plugin on GitHub, installable via marketplace.
**Depends on:** Phases 1-4 all complete.
**Reference:** See `v9.5.0-master-plan.md` for verification criteria, scope exclusions, and "Things You Might Have Forgotten."

---

## Pre-flight

- [ ] Phase 1 complete: 8 ported skills working
- [ ] Phase 2 complete: 7 new skills working (all 15 in menu)
- [ ] Phase 3 complete: ~30 examples + 10 docs in plugin directory
- [ ] Phase 4 complete: MCP server builds, 7 tools + 2 resources working

---

## 5.1: Create and run sanitization validator

Create `scripts/validate-plugin.sh` that scans ALL plugin files for:

**Project-specific terms:**
- `resume`, `resume optimization`
- `enforcement`, `enforcement saga`
- `v9.3`, `v9.4`, `v9.3.x`
- `Shadow Sync` (as feature name, not example reference)
- `optimize-my-resume`

**Personal/sensitive information:**
- Names, email addresses
- Company-specific references
- Hardcoded paths: `/Users/mkaplan`, specific repo paths

**Original project artifacts:**
- GitHub issue numbers from original project (#1-#103)
- Branch names from original project (v9.3.x, v9.4.0)

**Output:** List of violations with `file:line` references
**Exit code:** 1 if any violations found, 0 if clean

**Run until zero violations.** Fix all findings, re-run.

---

## 5.2: Validate plugin structure

Verify plugin loads correctly:
```bash
claude --plugin-dir ./knowledge-graph-plugin
```

Check:
- [ ] `.claude-plugin/plugin.json` is valid JSON
- [ ] All 15 skill directories have `SKILL.md`
- [ ] Hooks resolve and fire
- [ ] MCP server starts

**Note (Opus #3):** `claude plugin validate` may not be a real CLI command. Use manual verification above. If the validate command exists at time of implementation, use it as well.

---

## 5.3: Validate `core/` accessibility

**Critical (Opus #1):** Test whether `${CLAUDE_PLUGIN_ROOT}/core/templates/` is accessible after plugin installation.

If plugin caching flattens the directory:
- **Mitigation A:** Skills/MCP tools that reference `core/` paths inline the template content instead
- **Mitigation B:** Move templates to `templates/` at plugin root (parallel to `skills/`)
- Document which approach was needed in CHANGELOG.md

---

## 5.4: Test all 16 skills + MCP server end-to-end

Test locally with `claude --plugin-dir ./knowledge-graph-plugin`:

### Phase 1 skills (re-verify):
- [ ] `/knowledge:capture-lesson` — creates lesson with git metadata frontmatter
- [ ] `/knowledge:recall` — searches across all KG systems
- [ ] `/knowledge:update-graph` — extracts entries preserving metadata
- [ ] `/knowledge:sync-all` — runs full pipeline
- [ ] `/knowledge:update-issue-plan` — syncs to issue (GitHub optional)
- [ ] `/knowledge:session-summary` — generates session doc
- [ ] `/knowledge:extract-chat` — runs Python scripts, output goes to active KG
- [ ] `/knowledge:meta-issue` — scaffolds directory structure

### Phase 2 skills (re-verify):
- [ ] `/knowledge:init` — wizard creates KG, writes to kg-config.json
- [ ] `/knowledge:list` — displays all configured KGs
- [ ] `/knowledge:switch` — changes active KG, subsequent skills use it
- [ ] `/knowledge:add-category` — adds category to existing KG
- [ ] `/knowledge:configure-sanitization` — sets up pre-commit hook
- [ ] `/knowledge:check-sensitive` — scans and reports sensitive data
- [ ] `/knowledge:link-issue` — links lesson to GitHub issue
- [ ] `/knowledge:status` — shows active KG info, stats, and quick reference

### Phase 4 MCP server:
- [ ] MCP tools appear in tool list
- [ ] `kg_config_init` creates KG correctly
- [ ] `kg_search` returns relevant results
- [ ] `kg_scaffold` creates files from templates
- [ ] `kg_check_sensitive` reports findings
- [ ] Skills that delegate to MCP tools work end-to-end

### Integration tests:
- [ ] Full workflow: init → capture-lesson → update-graph → recall
- [ ] Multi-KG: init → switch → capture-lesson (verify correct KG used)
- [ ] GitHub-optional mode (no remote configured — graceful skip)
- [ ] Hook fires on SessionStart
- [ ] Non-Claude user path: MCP server standalone with MCP inspector
- [ ] Examples clearly marked and not copied during init

---

## 5.5: Fix bugs discovered during testing

Fix any issues found in 5.4. After fixes:
1. Re-run `scripts/validate-plugin.sh`
2. Re-test affected skills and MCP tools
3. Verify no regressions

---

## 5.6: Extract to separate repository

```bash
mkdir ~/Documents/GitHub/knowledge-graph-plugin
cp -r knowledge-graph-plugin/* ~/Documents/GitHub/knowledge-graph-plugin/
cp -r knowledge-graph-plugin/.claude-plugin ~/Documents/GitHub/knowledge-graph-plugin/
cd ~/Documents/GitHub/knowledge-graph-plugin

# Build MCP server in new location
cd mcp-server && npm install && npm run build && cd ..

git init
git add -A
git commit -m "feat: initial release of knowledge plugin v1.0.0

16 skills, MCP server (7 tools + 2 resources), multi-KG support,
git metadata tracking, ~30 generalized examples.
Platform-agnostic core in core/ for non-Claude users.
MCP server usable standalone by Cursor/Continue/Cline users.
"
```

---

## 5.7: Publish to GitHub

1. Create GitHub repo: `technomensch/knowledge-graph-plugin`
2. `git remote add origin <url>`
3. `git push -u origin main`
4. Test installation from separate path: `claude --plugin-dir ~/Documents/GitHub/knowledge-graph-plugin`
5. Verify skills + MCP server work when installed from external path
6. Optional: Create marketplace.json
7. Optional: Submit to official directory

---

## Exit Criteria

- [ ] `validate-plugin.sh` passes with ZERO violations
- [ ] All 16 skills tested and working
- [ ] MCP server tested (7 tools + 2 resources)
- [ ] `core/` paths accessible (or mitigated per 5.3)
- [ ] Plugin works from standalone repo (not just embedded in optimize-my-resume)
- [ ] Published to GitHub
- [ ] README.md has installation instructions for both plugin and MCP server
- [ ] Non-Claude users can use MCP server standalone
